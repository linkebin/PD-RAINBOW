<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yidusoft.project.business.dao.VisitingRecordMapper">
  <resultMap id="BaseResultMap" type="com.yidusoft.project.business.domain.VisitingRecord">
    <!--
      WARNING - @mbg.generated
    -->
    <id column="ID_" jdbcType="VARCHAR" property="id" />
    <result column="record_code" jdbcType="VARCHAR" property="recordCode" />
    <result column="Visiting_purpose" jdbcType="VARCHAR" property="visitingPurpose" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="visitor_time" jdbcType="TIMESTAMP" property="visitorTime" />
    <result column="creator" jdbcType="VARCHAR" property="creator" />
    <result column="deleted" jdbcType="INTEGER" property="deleted" />
    <result column="visitor_id" jdbcType="VARCHAR" property="visitorId" />
    <result column="process_log" jdbcType="LONGVARCHAR" property="processLog" />
    <result column="Follow_up_plan" jdbcType="LONGVARCHAR" property="followUpPlan" />
    <result column="remarks" jdbcType="LONGVARCHAR" property="remarks" />
  </resultMap>
  <!--AND visitor_time &gt;=#{startTime} AND visitor_time &lt;=#{endTime}-->
  <select id="findVisitingRecordShaftTimeByCustomerId" parameterType="com.yidusoft.project.business.domain.VisitingRecord"
          resultMap="BaseResultMap">

    SELECT ID_,visitor_time FROM visiting_record WHERE deleted=0 AND visitor_id=#{visitorId}

  </select>

  <select id="findVisitingRecordByParameter" parameterType="com.yidusoft.project.business.domain.VisitingRecord"
         resultType="java.util.HashMap">

     SELECT vr2.visitor_name,vr.* FROM visiting_record vr
      LEFT JOIN visitor_register vr2 ON vr.visitor_id=vr2.ID_

    WHERE vr.deleted=0 AND vr.creator=#{creator}

    <if test="sex!=null and sex!=''">
      AND vr2.sex= #{sex}
    </if>

    <if test="visitorName!=null and visitorName!=''">
      AND vr2.visitor_name LIKE '%${visitorName}%'
    </if>

  </select>
</mapper>