
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>添加问卷</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/Styles/themes/default/style.css"  media="all">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/Scripts/libs/ztree/css/demo.css" media="all">
    <link rel="stylesheet" href="/Scripts/libs/ztree/css/metroStyle/metroStyle.css" type="text/css">
  <style>

      .eui-icon-rigth{
          font-size: 20px;
          position: absolute;
          right: 15px;
          top: 0;
      }
  </style>
</head>
<body>
<div class="eui-padding15">

    <div>
      <form class="eui-form " action=""  id="formQuestionnaire" >
        <div class="eui-row eui-searchTitle eui-paddingB10 eui-marginB20">
            <div class="eui-col-md6">
                <span class="eui-panels-title1">添加问卷</span>
            </div>
            <div class="eui-col-md6">
                <div class="eui-btn-group eui-panelsIn">
                    <a href="#"  class="eui-btn"  onclick="saveGauge()"><i class="eui-icon">&#xe60a;</i> 保存</a>
                </div>
            </div>
        </div>
        <div class="eui-row"   >
            <div class="eui-col-xs6 eui-col-sm6 eui-col-md12"  >
                    <input type="hidden" id="sceneId" name="sceneId"/>
                    <input type="hidden" id="tagId" name="tagId"/>
                    <input type="hidden" id="questionStr" name="questionStr"/>
                    <div class="eui-form-item">
                        <label class="eui-form-label">名称</label>
                        <div class="eui-input-inline">
                            <input type="text" id="questionnaireName" name="questionnaireName" e-verify="" autocomplete="off" placeholder="请输入名称" class="eui-input">
                        </div>

                        <label class="eui-form-label">选择量表</label>
                        <div class="eui-input-inline">
                            <select name="gaugeId" id="gaugeId" e-filter="gaugeId"  e-verify="" >
                            </select>
                        </div>



                        <label class="eui-form-label">上架时间</label>
                        <div class="eui-input-inline">
                            <input type="text" class="eui-input" name="shelfTime" id="times" placeholder="请选择时间">
                        </div>

                      </div>
                      <div class="eui-form-item">


                         <label class="eui-form-label">问卷类型</label>
                         <div class="eui-input-inline">
                             <select name="questionnaireType" id="questionnaireType" e-verify="gaugeType" >
                             </select>
                         </div>

                         <label class="eui-form-label">模板类型</label>
                         <div class="eui-input-inline">
                            <select name="answerModelType" id="answerModelType" e-verify="" >
                                 <option value="">请选择</option>
                                 <option value="1">横版</option>
                                 <option value="2">竖版</option>
                            </select>
                         </div>
                      <!-- <label class="eui-form-label">答案正反序</label>-->
                       <div class="eui-input-inline" style="display: none">
                           <input type="radio" name="questionSequence" value="0" title="正" checked>
                           <input type="radio" name="questionSequence" value="1" title="反" >
                       </div>



                    </div>


                    <div class="eui-form-item">
                        <label class="eui-form-label">备注</label>
                        <div class="eui-input-block">
                            <textarea placeholder="备注"  name="remarks" id="remarks" class="eui-textarea"></textarea>
                        </div>
                    </div>



            </div>

        </div>
      </form>



        <div class="eui-row eui-searchTitle eui-paddingB10 eui-marginB20">
            <div class="eui-col-md6">
                <span class="eui-panels-title2"><i class="eui-icon">&#xe600;</i>标签</span>
            </div>
            <div class="eui-col-md6">
                <div class="eui-btn-group eui-panelsIn">
                    <div class="eui-input-block " style="margin-left: 120px;" >
                        <p  style="margin-left: 0px; width: 120px; height: 36px; margin-top: 3px; line-height: 36px;"   class="eui-btn eui-btn-small" onclick="loadTag()">
                            <i style="font-size: 30px; line-height: 36px;" class="eui-icon">&#xe608;</i>添加标签</p>
                        <!--<button type="button"  id="addMember"  class="eui-btn eui-btn-small" onclick="checkMember()"><i class="eui-icon">&#xe654;</i> 添加成员</button>-->
                    </div>
                </div>
            </div>
        </div>
        <div class="eui-form-item eui-row">
            <div class="eui-col-md12" id="divtag">
                <!--标签-->
              </div>
        </div>

        <div class="eui-row eui-searchTitle eui-paddingB10 eui-marginB20">
            <div class="eui-col-md6">
                <span class="eui-panels-title2"><i class="eui-icon">&#xe62e;</i>场景</span>
            </div>
            <div class="eui-col-md6">
                <div class="eui-btn-group eui-panelsIn">
                    <div class="eui-input-block " style="margin-left: 120px;">
                        <p  style="margin-left: 0px; width: 120px; height: 36px; margin-top: 3px; line-height: 36px;"    class="eui-btn eui-btn-small" onclick="loadScene()">
                            <i style="font-size: 30px; line-height: 36px;" class="eui-icon">&#xe608;</i>添加场景</p>
                        <!--<button type="button"  id="addMember"  class="eui-btn eui-btn-small" onclick="checkMember()"><i class="eui-icon">&#xe654;</i> 添加成员</button>-->
                    </div>
                </div>
            </div>
        </div>
        <div class="eui-form-item eui-row">
            <div class="eui-col-md12" id="divscene">
                <!--场景-->
            </div>
        </div>




        <div class="eui-row eui-searchTitle eui-paddingB10 eui-marginB20">
            <div class="eui-col-md6">
                <span class="eui-panels-title2"><i class="eui-icon">&#xe60a;</i>可选的问题</span>
            </div>
            <div class="eui-col-md6">
                <div class="eui-btn-group eui-panelsIn">
                    <button class="eui-btn" onclick="chageQuestion()"><i class="eui-icon">&#xe60a;</i> 选择</button>
                </div>
            </div>
        </div>
        <div class="eui-row"   >
            <div class="eui-col-xs6 eui-col-sm6 eui-col-md12"  >
                <form class="eui-form " id="searchFrom" action=""   >
                    <input type="hidden" id="id" name="id"/>
                    <div class="eui-form-item">
                        <table class="eui-table eui-form" id="questionTable">
                            <colgroup>
                                <col width="60">
                                <col>
                            </colgroup>
                            <thead>
                            <tr>
                                <th><input type="checkbox" name="" title="" e-filter="allChoose" e-skin="primary"></th>
                                <th>问题编号</th>
                                <th>问题内容</th>
                                <th>选项</th>
                                <th>答案对应分数</th>
                                <th>答案</th>
                                <th>答案类型</th>
                            </tr>
                            </thead>
                            <tbody>

                            </tbody>
                        </table>
                        <div id="pages"></div>
                    </div>
                </form>
            </div>

        </div>

        <div class="eui-row eui-searchTitle eui-paddingB10 eui-marginB20">
            <div class="eui-col-md6">
                <span class="eui-panels-title2"><i class="eui-icon">&#xe60a;</i>已选的问题</span>
            </div>
        </div>
        <div class="eui-collapse" e-filter="test" >
                <div class="eui-colla-item">
                    <h2 class="eui-colla-title">选择量表的问题</h2>
                    <div class="eui-colla-content eui-show" id="questionCollapse">
                      <!--  这里放选择的量表问题-->
                    </div>
                </div>
                <div class="eui-colla-item">
                    <h2 class="eui-colla-title">新增的问题</h2>
                    <div class="eui-colla-content" id="addQuestionCollapse">
                         <!--这里放新添加的问题-->
                    </div>
                </div>

            <!-- <div class="eui-colla-item ">
                 <h2 class="eui-colla-title">为什么前端工程师多不愿意用 Bootstrap 框架？
                     <i  title="删除" onclick="deleteQuestion()" class="eui-icon eui-icon-rigth" >&#xe640;</i>
                 </h2>
                 <div class="eui-colla-content eui-show">
                     <p>因为不适合。如果希望开发长期的项目或者制作产品类网站，那么就需要实现特定的设计，为了在维护项目中可以方便地按设计师要求快速修改样式，
                         肯定会逐步编写出各种业务组件、工具类，相当于为项目自行开发一套框架。——来自知乎@Kayo</p>
                 </div>
             </div>-->
        </div>



    </div>

</div>







<script src="/Scripts/module/eui.js" charset="utf-8"></script>
<script src="/Scripts/main.js" charset="utf-8"></script>
<script type="text/javascript" src="/Scripts/jquery-1.9.0.min.js"></script>
<script src="/Scripts/libs/ligerUI/js/ligerui.all.js" type="text/javascript"></script>
<script src="/pack.ajax.js" charset="utf-8"></script>
<script src="/date2format.js" charset="utf-8"></script>
<script src="/Scripts/plugins/md5/md5.min.js" type="text/javascript"></script>
<script src="/Scripts/plugins/jquery.validate.js"></script>



<script>
//手风琴折叠
    eui.use(['element', 'layer'], function(){
        var element = eui.element;
        var layer = eui.layer;

        //监听折叠
        element.on('collapse(test)', function(data){
            //layer.msg('展开状态：'+ data.show);
        });
    });



// 表单
eui.use(['form', 'layedit', 'laydate','laypage', 'layer'], function(){
    var form = eui.form
    ,layer = eui.layer
    ,layedit = eui.layedit
    ,laydate = eui.laydate
    ,laypage = eui.laypage;


//常规用法
    laydate.render({
        elem: '#times'
    });


    //全选
    form.on('checkbox(allChoose)', function(data){
        var child = $(data.elem).parents('table').find('tbody input[type="checkbox"]');
        child.each(function(index, item){
            item.checked = data.elem.checked;
        });
        form.render('checkbox');
    });

    //监听提交
    form.on('submit(demo)', function(data){
        layer.alert(JSON.stringify(data.field), {
            title: '最终的提交信息'
        });
        return false;
    });

//验证
    form.verify({
        gaugeName: function(value, item){ //value：表单的值、item：表单的DOM对象
            if("".test(value)){
                return '量表名称不能为空！';
            }
        },
        gaugeType: function(value, item){ //value：表单的值、item：表单的DOM对象
            if("".test(value)){
                return '类型不能为空！';
            }
        }
        //我们既支持上述函数式的方式，也支持下述数组的形式
        //数组的两个值分别代表：[正则匹配、匹配不符时的提示文字]
       /* ,gaugeType: [
            /^[\S]{6,12}$/
            ,'密码必须6到12位，且不能出现空格'
        ]*/
    });


    //日期范围
    laydate.render({
        elem: '#test6'
        ,range: true
    });
    //select 的选择监听事件
    form.on('select(gaugeId)', function(data){
        console.log(data.elem); //得到select原始DOM对象
        console.log(data.value); //得到被选中的值
        console.log(data.othis); //得到美化后的DOM对象
        checkGauge(data.value);
    });

});

</script>

<script>

    $(function () {
        doSearch();
        loadGaugeType ();
        loadGauge ();
    });
    //定义一个装id的数组
   var idArray="";
    //加载数据
    function doSearch() {
        eui.use(['form','laypage','layer'], function(){
            var form = eui.form
                ,laypage = eui.laypage
                ,layer = eui.layer,
                $ = eui.jquery;
            //数据给id
            $("#id").val(idArray);
            var params = $("#searchFrom").serializeObject();
            //加载层
            var index = layer.load(0, {shade: false}); //0代表加载的风格，支持0-2
            $.ajax({
                url:"/questionnaire/question/findQuestionBYid",
                data: {
                    params:JSON.stringify(params),
                    page:1,
                    size:10
                },
                type:"post",
                success:function(result){
                    layer.closeAll();
                    // 分页
                    laypage.render({
                        elem: 'pages'
                        ,count: result.data.total
                        ,layout: ['count', 'prev', 'page', 'next', 'limit', 'skip']
                        ,skip: true
                        ,jump: function(obj,first){
                            if (first){
                                //第一次，不需要查询数据
                                var questionList = result.data.list;
                                //遍历，拼接表格
                                var tableHtml = getTable(questionList);
                                $("#questionTable tbody").html(tableHtml);
                                form.render('checkbox');
                            }else {
                                var params = $("#searchFrom").serializeObject();
                                //加载层
                                var index = layer.load(0, {shade: false}); //0代表加载的风格，支持0-2
                                $.ajax({
                                    url: "/questionnaire/question/questionListByPage",
                                    data: {
                                        params: JSON.stringify(params),
                                        page: obj.curr,
                                        size: obj.limit
                                    },
                                    type: "post",
                                    success: function (result) {
                                        layer.closeAll();
                                        var questionList = result.data.list;
                                        //遍历，拼接表格
                                        var tableHtml = getTable(questionList);
                                        $("#questionTable tbody").html(tableHtml);
                                        //重新加载复选框
                                        form.render('checkbox');
                                    }
                                });
                            }
                        }
                    });
                }
            });

        });
    }

    //渲染数据，拼接表格
    function getTable(questionList) {
        var tableHtml = '';

             for (var item in questionList){
            var question=questionList[item];
            var  questionType="";
            if(question.questionType=='1'){
                questionType="单选";
            }else if(question.questionType=='2'){
                questionType="多选";
            }else {
                questionType="评分单选";
            }
            tableHtml +=  '<tr>' +
                '<td><input name="" e-skin="primary" class="mycheckbox" type="checkbox"><input name="questionId" type="hidden" value="' + question.id + '"></td>' +
                '<td>'+ question.questionCode +'</td>' +
                '<td>'+ question.questionContent +'</td>' +
                '<td>'+ question.optionAnswer +'</td>'   +
                '<td>'+ question.optionScore +'</td>' +
                '<td>'+ question.answer +'</td>' +
                '<td>'+ questionType +'</td>' +
                '</tr>';
        }

        return tableHtml;
    }

    //删除问题
    function deleteQuestion(id){
        var ids='div'+id;
        //替换掉idArray 里面存在的ida
        idArray=idArray.replace(id+",","");
        idArray=idArray.replace(","+id,"");
        idArray=idArray.replace(id,"");
        $("#"+ids).remove();
        doSearch();
        spanSequence();
    }
    //选择问题
    function chageQuestion() {
    eui.use(['form','laypage','layer'], function(){
        var form = eui.form
            ,elem=eui.elem
            ,laypage = eui.laypage
            ,layer = eui.layer,
            $ = eui.jquery;
        var ids="";
        idArray+=",";
        if (ids==''){
            $(".mycheckbox:checked").each(function(i){
                var id = $(this).parent().find("input[name='questionId']").val();
                ids += id + ',';
                idArray+=id+","
            });
        }

        if (ids==''){
            layer.msg('请选择问题', {
                time: 2000
            });
            return ;
        }
        var item=idArray.substring(0,1);
        if(item==','){
            idArray=idArray.substring(1,idArray.length-1);
        }else {
            idArray=idArray.substring(0,idArray.length-1);
        }

        doSearch();
        //加载层
        var index = layer.load(0, {shade: false}); //0代表加载的风格，支持0-2
        $.post("/questionnaire/question/findQuestion",{"ids":ids},function (result) {
                layer.closeAll();
            var context= questionList(result.data,"show");
            $("#addQuestionCollapse").append(context);
            spanSequence();
        });
      });
    }

    //拼接问题列表
    function  questionList(questionList,type){
        //type show选择的问题能删除   hide选择的量表不能删除
        var context="";
        for(var item in questionList){
         var  question=  questionList[item];
             context+='<div name="questionIds"  question="'+question.id+'" id="div'+question.id+'" class="eui-colla-item ">';
             context+='  <h2  class="eui-colla-title"><span name="spanNumber"></span>'+question.questionContent;
             if(type=='show'){
               context+='  <i  title="删除" onclick="deleteQuestion(\''+question.id+'\')" class="eui-icon eui-icon-rigth" >&#xe640;</i> ';
             }
             context+='  </h2> ';
             context+=' <div class="eui-colla-content eui-show"> ';
             var optionScore=question.optionScore+"";
             var  optionAnswer=question.optionAnswer+"";
             var optionScoreArray=optionScore.split("||");
             var optionAnswerArray=optionAnswer.split("||");
            context+='   <p> ';
             for(var i=0;i<optionAnswerArray.length;i++){
                 context+=optionAnswerArray[i]+"("+optionScoreArray[i]+"分)";
             }
             context+=' <p>答案：'+question.answer+'  </p> ';
             context+='   </p> ';
             context+='  </div>  ';
             context+='</div>  ';
        }
     return context;
    }

    //量表类型加载
    function  loadGaugeType () {
       $.post("/questionnaire/type/typeTree",{},function(result){
           var context="";
           var list=result.data;
               context+=" <option value=''>请选择类型</option>";
           for( var i in  list){
               context+="<option value='"+list[i].id+"'>"+list[i].name+" </option>";
           }
           $("#questionnaireType").html(context);
           //更新
           formRender();

       });

    }

    //量表模板加载
    function  loadGauge () {
        $.post("/gauge/findGaugeAll",{},function(result){
            var context="";
            var list=result.data;
            context+=" <option value=''>请选择</option>";
            for( var i in  list){
                if(list[i].gaugeState==0){
                  context+="<option value='"+list[i].id+"'>"+list[i].gaugeName+" </option>";
                }
            }
            $("#gaugeId").html(context);
            //更新
            formRender();

        });

    }

    //保存问卷
     function saveGauge(){
         var questionId=document.getElementsByName("questionIds");
         var questionArray=new Array();
         for(var i=0;i<questionId.length;i++){
             var ids=questionId[i].id;
             questionArray[i]=$("#"+ids).attr("question");
         }
         var questionStr=questionArray.join(",");
         $("#questionStr").val(questionStr);

       //验证
       if($("#questionnaireName").val()==""){
           layer.msg('请填写名称', {
               time: 2000
           });
           return;
       }else if($("#times").val()==""){
           layer.msg('请选择上架时间', {
               time: 2000
           });
           return;
       }else if($("#questionStr").val()==""){
           layer.msg('请选择问题', {
               time: 2000
           });

           return;
       }else if($("#questionStr").val()==""){
           layer.msg('请选择问题', {
               time: 2000
           });

           return;
       }else if($("#answerModelType").val()==""){
           layer.msg('请选择模板类型', {
               time: 2000
           });
           return;
       }
       //给标签设置值
         $("#tagId").val(getTagOrSceneId("tag"));
       //给场景设置值
         $("#sceneId").val(getTagOrSceneId("scene"));

         var formQuestionnaire=$("#formQuestionnaire").serialize();
         console.info("formQuestionnaire");
         console.info(formQuestionnaire);
         //加载层
         var index = layer.load(0, {shade: false}); //0代表加载的风格，支持0-2
        $.post("/questionnaire/addQuestionnaire",formQuestionnaire,function (result) {
            if(result.code==200){
                layer.closeAll();
                layer.msg('添加成功', {
                    time: 2000
                });
                    window.close();
                    window.opener.location.href=window.opener.location.href;

            }else {
                layer.msg('添加失败', {
                    time: 2000
                });
            }
        });
     }

     //  量表的标签加载 并返回选择的标签
     function  loadTag() {
         var list=new Array;
         eui.use(['form','layer'], function() { //独立版的layer无需执行这一句
             var $ = eui.jquery,
                 layer = eui.layer,form=eui.form; //独立版的layer无需执行这一句
             var iframeWin;//iframe对象
             layer.open({
                 type: 2
                 ,id: 'checkTag'
                 ,title: '选择标签'
                 ,area: ['800px', '500px']
                 ,success: function(layero, index){

                         var body = layer.getChildFrame('body', index);
                         iframeWin = window[layero.find('iframe')[0]['name']]; //得到iframe页的窗口对象，执行iframe页的方法：
                       //  body.find('input').val('Hi，我是从父页来的')
                     }
                 ,shade: 0
                 ,moveType: 0//拖拽模式，0或者1
                 ,maxmin: true
                 ,content:"/web/gauge/getGaugeTag"
                 ,btn: ['确定', '关闭'] //只是为了演示
                 ,yes: function(){
                     layer.closeAll();
                   //得到设置返回的结果
                     list=iframeWin.getCheckTag();
                     merge("tag",list)
                 }
                 ,btn2: function(){
                     layer.closeAll();
                 }
                 ,zIndex: layer.zIndex //重点1
             });
         });

     }



    //  量表的场景加载 并返回选择的场景
    function  loadScene() {
        var list=new Array;
        eui.use(['form','layer'], function() { //独立版的layer无需执行这一句
            var $ = eui.jquery,
                layer = eui.layer,form=eui.form; //独立版的layer无需执行这一句
            var iframeWin;//iframe对象
            layer.open({
                type: 2
                ,id: 'checkScene'
                ,title: '选择场景'
                ,area: ['800px', '500px']
                ,success: function(layero, index){

                    var body = layer.getChildFrame('body', index);
                    iframeWin = window[layero.find('iframe')[0]['name']]; //得到iframe页的窗口对象，执行iframe页的方法：
                    //  body.find('input').val('Hi，我是从父页来的')
                }
                ,shade: 0
                ,moveType: 0//拖拽模式，0或者1
                ,maxmin: true
                ,content:"/web/gauge/getGaugeScene"
                ,btn: ['确定', '关闭'] //只是为了演示
                ,yes: function(){
                    layer.closeAll();
                    //得到设置返回的结果
                    list=iframeWin.getCheckScene();
                    merge("scene",list)
                }
                ,btn2: function(){
                    layer.closeAll();
                }
                ,zIndex: layer.zIndex //重点1
            });
        });

    }


     //拼接标签 或者 场景
     function  merge(type,list){
         var context="";
         //得到所有的成员
         var typeAll= $("[name='"+type+"']");
         if(typeAll==null){
             for(var i=0;i<list.length;i++){
                 context+=  '<span id="'+type+list[i].id+'" name="'+type+'" style="width: 120px; margin: 0px 5px 5px 0px;" ' +
                     'class="eui-btn eui-btn-primary" '+type+'Id='+list[i].id+'>'+list[i].name+' <i  onclick="deleteTagOrScene(\''+type+'\',\''+list[i].id+'\')" class="eui-icon" name="'+type+'">&#x1006;</i></span>';
             }
         }else {
        //去掉重复的 标签或者场景
        for(var i=0;i<list.length;i++){
            var stast=0;
            for(var j=0;j<typeAll.length;j++){
                var typeId = typeAll.eq(j).attr(type+"Id");
                if(list[i].id==typeId){
                    stast++;
                }
            }
            if(stast==0){
                context+=  '<span id="'+type+list[i].id+'" name="'+type+'" style="width: 120px; margin: 0px 5px 5px 0px;" ' +
                    'class="eui-btn eui-btn-primary" '+type+'Id='+list[i].id+'>'+list[i].name+' <i  onclick="deleteTagOrScene(\''+type+'\',\''+list[i].id+'\')" class="eui-icon" name="'+type+'">&#x1006;</i></span>';
            }else{
                stast=0;
            }
        }
         $("#div"+type).before(context);
    }


     }
  //删除场景  或者标签
    function deleteTagOrScene(type,id){
       $("#"+type+id).remove();
  }

  //获得场景 或者标签的id 1,2,3
    function getTagOrSceneId(type){
        var spanNmae= $("[name='"+type+"']");
        var list=new Array();
        for(var i=0;i<spanNmae.length;i++){
            list[i]=spanNmae.eq(i).attr(type+"Id");

        };
        return list.join(",");
    }

   //选择量表 则查询出相关的 标签  场景
   function checkGauge(gaugeId){
      $.post("/gauge/getGaugeInfo",{"gaugeId":gaugeId},function (result) {
          console.info("result");
          console.info(result);
         // gauge gaugeQuestionList questionnaireTagList sceneList
          //量表的信息填充
          var gauge=result.data.gauge;
          $("#questionnaireName").val(gauge.gaugeName);
          $("#questionnaireType").val(gauge.gaugeType);
          formRender();

          //问题的的信息填充
          var questions=result.data.gaugeQuestionList;
          var texts="";
          for(var i=0;i<questions.length;i++){
              texts+=questions[i].questionId+",";
          }
          texts=texts.substring(0,texts.length-1);
          $("#questionStr").val(texts);
          var questionnaireTagList=result.data.questionnaireTagList;
          var sceneList=result.data.sceneList;
          initializeQuestion(questions,questionnaireTagList,sceneList)
      });

   }

    //初始化选择的量表
    function  initializeQuestion(questions,questionnaireTagList,sceneList) {
        eui.use(['form','laypage','layer'], function(){
            var form = eui.form
                ,elem=eui.elem
                ,laypage = eui.laypage
                ,layer = eui.layer,
                $ = eui.jquery;

            //标签
            var tagList=new Array;
            for(var i in  questionnaireTagList){
                var obj=new Object();
                obj.id=questionnaireTagList[i].id;
                obj.name=questionnaireTagList[i].tagName;
                tagList.push(obj);
            }
            merge("tag",tagList);
            //场景
            var scenes=new Array;
            for(var i in  sceneList){
                var obj=new Object();
                obj.id=sceneList[i].id;
                obj.name=sceneList[i].sceneName;
                scenes.push(obj);
            }
            merge("scene",scenes);

            //问题
            var ids="";
            idArray=",";
            for(var i in  questions){
                ids += questions[i].questionId+ ',';
                idArray+=questions[i].questionId +","
            }

            var item=idArray.substring(0,1);
            if(item==','){
                idArray=idArray.substring(1,idArray.length-1);
            }else {
                idArray=idArray.substring(0,idArray.length-1);
            }

            doSearch();
            //加载层
            var index = layer.load(0, {shade: false}); //0代表加载的风格，支持0-2
            $.post("/questionnaire/question/findQuestion",{"ids":ids},function (result) {
                layer.closeAll();
                //如果是选择的量表，则不能删除问题
                var context= questionList(result.data,"hide");
                $("#questionCollapse").append(context);
                spanSequence();

            });
        });
    }
  
    //对问题的排序
    function  spanSequence() {
       var spanNumber=  $("[name='spanNumber']");
       for(var i=0;i<spanNumber.length;i++){
           spanNumber.eq(i).text(i+1+".");
       }
    }




    //form表单  select,checkbox,radio 动态添加  需要更新
     function   formRender() {
         eui.use(['form'], function(){
             var form = eui.form;
             form.render();
         });
     }


</script>

</body>
</html>
