
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>添加量表</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="/Styles/themes/default/style.css"  media="all">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/Scripts/libs/ztree/css/demo.css" media="all">
    <link rel="stylesheet" href="/Scripts/libs/ztree/css/metroStyle/metroStyle.css" type="text/css">
  <style>

      .eui-icon-rigth{
          font-size: 20px;
          position: absolute;
          right: 15px;
          top: 0;
      }
  </style>
</head>
<body>
<div class="eui-padding15">

    <div>
        <div class="eui-row eui-searchTitle eui-paddingB10 eui-marginB20">
            <div class="eui-col-md6">
                <span class="eui-panels-title1">添加量表</span>
            </div>
            <div class="eui-col-md6">
                <div class="eui-btn-group eui-panelsIn">
                    <button class="eui-btn"><i class="eui-icon">&#xe642;</i> 编辑</button>
                    <button class="eui-btn"><i class="eui-icon">&#xe60a;</i> 保存</button>
                </div>
            </div>
        </div>
        <div class="eui-row"   >
            <div class="eui-col-xs6 eui-col-sm6 eui-col-md12"  >
                <form class="eui-form " action=""   >
                    <div class="eui-form-item">
                        <label class="eui-form-label">名称</label>
                        <div class="eui-input-inline">
                            <input type="text" name="title" e-verify="title" autocomplete="off" placeholder="姓名" class="eui-input">
                        </div>
                        <label class="eui-form-label">量表类型</label>
                        <div class="eui-input-inline">
                            <select name="quiz2">
                                <option value="">请选择市</option>
                                <option value="杭州">杭州</option>
                                <option value="宁波" disabled="">宁波</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>

        </div>

        <div class="eui-row eui-searchTitle eui-paddingB10 eui-marginB20">
            <div class="eui-col-md6">
                <span class="eui-panels-title2"><i class="eui-icon">&#xe60a;</i>选择问题</span>
            </div>
            <div class="eui-col-md6">
                <div class="eui-btn-group eui-panelsIn">
                    <button class="eui-btn" onclick="chageQuestion()"><i class="eui-icon">&#xe60a;</i> 确定</button>
                </div>
            </div>
        </div>
        <div class="eui-row"   >
            <div class="eui-col-xs6 eui-col-sm6 eui-col-md12"  >
                <form class="eui-form " action=""   >
                    <div class="eui-form-item">
                        <table class="eui-table eui-form" id="questionTable">
                            <colgroup>
                                <col width="60">
                                <col>
                            </colgroup>
                            <thead>
                            <tr>
                                <th><input type="checkbox" name="" title="" e-filter="allChoose" e-skin="primary"></th>
                                <th>问题编号</th>
                                <th>问题内容</th>
                                <th>选项</th>
                                <th>对答案应分数</th>
                                <th>答案</th>
                                <th>答案类型</th>
                            </tr>
                            </thead>
                            <tbody>

                            </tbody>
                        </table>
                        <div id="pages"></div>
                    </div>
                </form>
            </div>

        </div>

        <div class="eui-row eui-searchTitle eui-paddingB10 eui-marginB20">
            <div class="eui-col-md6">
                <span class="eui-panels-title2"><i class="eui-icon">&#xe60a;</i>选择的问题列表</span>
            </div>
        </div>
        <div class="eui-collapse" e-filter="test" id="questionCollapse">
            <div class="eui-colla-item ">
                <h2 class="eui-colla-title">为什么前端工程师多不愿意用 Bootstrap 框架？
                    <i  title="删除" onclick="deleteQuestion()" class="eui-icon eui-icon-rigth" >&#xe640;</i>
                </h2>
                <div class="eui-colla-content eui-show">
                    <p>因为不适合。如果希望开发长期的项目或者制作产品类网站，那么就需要实现特定的设计，为了在维护项目中可以方便地按设计师要求快速修改样式，
                        肯定会逐步编写出各种业务组件、工具类，相当于为项目自行开发一套框架。——来自知乎@Kayo</p>
                </div>
            </div>
        </div>



    </div>

</div>







<script src="/Scripts/module/eui.js" charset="utf-8"></script>
<script src="/Scripts/main.js" charset="utf-8"></script>
<script type="text/javascript" src="/Scripts/jquery-1.9.0.min.js"></script>
<script src="/Scripts/libs/ligerUI/js/ligerui.all.js" type="text/javascript"></script>
<script src="/pack.ajax.js" charset="utf-8"></script>
<script src="/date2format.js" charset="utf-8"></script>
<script src="/Scripts/plugins/md5/md5.min.js" type="text/javascript"></script>
<script src="/Scripts/plugins/jquery.validate.js"></script>



<script>
//手风琴折叠
    eui.use(['element', 'layer'], function(){
        var element = eui.element;
        var layer = eui.layer;

        //监听折叠
        element.on('collapse(test)', function(data){
            //layer.msg('展开状态：'+ data.show);
        });
    });

// 表单
eui.use(['form', 'layedit', 'laydate','laypage', 'layer'], function(){
    var form = eui.form
    ,layer = eui.layer
    ,layedit = eui.layedit
    ,laydate = eui.laydate
    ,laypage = eui.laypage;

    //全选
    form.on('checkbox(allChoose)', function(data){
        var child = $(data.elem).parents('table').find('tbody input[type="checkbox"]');
        child.each(function(index, item){
            item.checked = data.elem.checked;
        });
        form.render('checkbox');
    });

    //日期范围
    laydate.render({
        elem: '#test6'
        ,range: true
    });


});

</script>

<script>

    $(function () {
        doSearch();
    });

    //加载数据
    function doSearch() {
        eui.use(['form','laypage','layer'], function(){
            var form = eui.form
                ,laypage = eui.laypage
                ,layer = eui.layer,
                $ = eui.jquery;

            var params = $("#searchFrom").serializeObject();
            //加载层
            var index = layer.load(0, {shade: false}); //0代表加载的风格，支持0-2
            $.ajax({
                url:"/questionnaire/question/questionListByPage",
                data: {
                    params:JSON.stringify(params),
                    page:1,
                    size:10
                },
                type:"post",
                success:function(result){
                    layer.closeAll();
                    // 分页
                    laypage.render({
                        elem: 'pages'
                        ,count: result.data.total
                        ,layout: ['count', 'prev', 'page', 'next', 'limit', 'skip']
                        ,skip: true
                        ,jump: function(obj,first){
                            if (first){
                                //第一次，不需要查询数据
                                var questionList = result.data.list;
                                //遍历，拼接表格
                                var tableHtml = getTable(questionList);
                                $("#questionTable tbody").html(tableHtml);
                                form.render('checkbox');
                            }else {
                                var params = $("#searchFrom").serializeObject();
                                //加载层
                                var index = layer.load(0, {shade: false}); //0代表加载的风格，支持0-2
                                $.ajax({
                                    url: "/questionnaire/question/questionListByPage",
                                    data: {
                                        params: JSON.stringify(params),
                                        page: obj.curr,
                                        size: obj.limit
                                    },
                                    type: "post",
                                    success: function (result) {
                                        layer.closeAll();
                                        var questionList = result.data.list;
                                        //遍历，拼接表格
                                        var tableHtml = getTable(questionList);
                                        $("#questionTable tbody").html(tableHtml);
                                        //重新加载复选框
                                        form.render('checkbox');
                                    }
                                });
                            }
                        }
                    });
                }
            });

        });
    }

    //渲染数据，拼接表格
    function getTable(questionList) {
        var tableHtml = '';

             for (var item in questionList){
            var question=questionList[item];
            tableHtml +=  '<tr>' +
                '<td><input name="" e-skin="primary" class="mycheckbox" type="checkbox"><input name="questionId" type="hidden" value="' + question.id + '"></td>' +
                '<td>'+ question.questionCode +'</td>' +
                '<td>'+ question.questionContent +'</td>' +
                '<td>'+ question.optionAnswer +'</td>'   +
                '<td>'+ question.optionScore +'</td>' +
                '<td>'+ question.answer +'</td>' +
                '<td>'+ question.questionType +'</td>' +
                '</tr>';
        }

        return tableHtml;
    }

    //删除问题
    function deleteQuestion(id){
        var ids='div'+id;
        $("#"+ids).remove();
    }
    //选择问题
    function chageQuestion() {
    eui.use(['form','laypage','layer'], function(){
        var form = eui.form
            ,elem=eui.elem
            ,laypage = eui.laypage
            ,layer = eui.layer,
            $ = eui.jquery;
        var ids="";
        if (ids==''){
            $(".mycheckbox:checked").each(function(i){
                var id = $(this).parent().find("input[name='questionId']").val();
                ids += id + ',';
            });
        }
        if (ids==''){
            layer.msg('请选择问题', {
                time: 2000
            });
            return ;
        }
        //加载层
        var index = layer.load(0, {shade: false}); //0代表加载的风格，支持0-2
        $.post("/questionnaire/question/findQuestion",{"ids":ids},function (result) {
                layer.closeAll();
            var context= questionList(result.data);
            $("#questionCollapse").append(context);

        });
      });
    }

    //拼接问题列表
    function  questionList(questionList){
        var context="";
        for(var item in questionList){
         var  question=  questionList[item];
             context+='<div id="div'+question.id+'" class="eui-colla-item ">';
             context+='  <h2  class="eui-colla-title">'+question.questionContent;
             context+='  <i  title="删除" onclick="deleteQuestion(\''+question.id+'\')" class="eui-icon eui-icon-rigth" >&#xe640;</i> ';
             context+='  </h2> ';
             context+=' <div class="eui-colla-content eui-show"> ';
             var optionScore=question.optionScore+"";
             var  optionAnswer=question.optionAnswer+"";
             var optionScoreArray=optionScore.split("||");
             var optionAnswerArray=optionAnswer.split("||");
            context+='   <p> ';
             for(var i=0;i<optionAnswerArray.length;i++){
                 context+=optionAnswerArray[i]+"("+optionScoreArray[i]+"分)";
             }
             context+=' <p>答案：'+question.answer+'  </p> ';
             context+='   </p> ';
             context+='  </div>  ';
             context+='</div>  ';
        }
     return context;
    }

</script>

</body>
</html>
