<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en"  xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <meta charset="UTF-8">
    <title>个人信息</title>
    <link rel="stylesheet" th:href="@{/Styles/themes/mycss/amazeui.cropper.css}">
    <link rel="stylesheet" th:href="@{/Styles/themes/mycss/amazeui.min.css}">
    <link rel="stylesheet" th:href="@{/Styles/themes/mycss/custom_up_img.css}">
    <link rel="stylesheet" th:href="@{/Styles/themes/default/style.css}" media="all">
    <style>
        .defaultDiv{width: 100%; border: 1px solid ghostwhite;}
        .formDiv .eui-form-item label{
            width: 120px;
            padding: 9px 20px;
            text-align: left;
        }
        .subBtn{color: white; background: #3f89ec;}

        input[type="button"],[type="submit"]{
            cursor: pointer;
        }
        input[name='userName'],[name='addr']{
            border: 1px solid #34a8ff;
        }
    </style>
</head>
<body class="eui-layout-body">
<div class="eui-layout eui-layout-admin xymfHome">
    <div th:replace="project/cube/common/header :: header(${7})">Header</div>
    <div class="eui-area">
        <div th:replace="project/cube/common/left :: left(${-1})">sidebar</div>
        <div class="eui-body">
            <!-- 内容主体区域 -->
            <div class="xymfContent">
                <div class="defaultDiv">
                        <div class="eui-padding15">
                            <h1 class="eui-font16">基本资料</h1>
                        </div>
                    <form style="width: 65%;float: left;" id="userInfoForm" class="eui-padding20" onsubmit="return false;">
                        <input type="hidden" th:value="${session.userSession.headImg}" name="headImg">
                        <div class="formDiv">
                            <input type="hidden" id="id" name="id" th:value="${session.userSession.id}">
                            <div class="eui-form-item">
                                <label class="eui-form-label">账号</label>
                                <div class="eui-input-inline">
                                    <input type="text" name="account" th:value="${session.userSession.account}" readonly="readonly" class="eui-input eui-width400">
                                </div>
                            </div>

                            <div class="eui-form-item">
                                <label class="eui-form-label">用户名</label>
                                <div class="eui-input-inline eui-width400">
                                    <input type="text" name="userName" th:value="${session.userSession.userName}"  class="eui-input eui-width400">
                                </div>
                                <div class="eui-form-mid eui-word-aux"><a id="error0" style="color: red;"></a></div>
                            </div>


                            <div class="eui-form-item">
                                <label class="eui-form-label">手机号</label>
                                <div class="eui-input-inline eui-width400">
                                    <input type="text" name="mobile" th:value="${session.userSession.mobile}" readonly="readonly"  class="eui-input eui-width400">
                                </div>
                                <div class="eui-form-mid eui-word-aux"><a>更改</a></div>
                            </div>

                            <div class="eui-form-item">
                                <label class="eui-form-label">邮箱</label>
                                <div class="eui-input-inline eui-width400">
                                    <input type="text" th:value="${session.userSession.email}" name="email" readonly="readonly"  class="eui-input eui-width400">
                                </div>
                                <div class="eui-form-mid eui-word-aux"><a>更改</a></div>
                            </div>

                            <div class="eui-form-item">
                                <label class="eui-form-label">推广码
                                    <!--<p class="eui-font12">(推荐好友时该码作为邀请码)</p>-->
                                </label>
                                <div class="eui-input-inline">
                                    <input th:value="${session.userSession.inviterCode}" type="text" name="inviterCode" readonly="readonly"  class="eui-input eui-width400">

                                </div>

                                <div class="eui-form-mid eui-word-aux"></div>
                            </div>
                            <div class="eui-form-item">
                                <label class="eui-form-label"></label>
                                <i> 提示: 邀请好友注册时。可将该推广码作为邀请码填充。作为您获得奖励的凭证</i>
                            </div>
                            <div  data-toggle="distpicker">
                            <div class="eui-form-item">
                                <label class="eui-form-label">省</label>
                                <div class="eui-input-inline">
                                    <select data-province="" id="province" class="eui-input eui-width400" e-ignore name="province">
                                    </select>
                                </div>
                                <div class="eui-form-mid eui-word-aux"></div>
                            </div>
                            <div class="eui-form-item">
                                <label class="eui-form-label">市</label>
                                <div class="eui-input-inline">
                                    <select data-province="" id="city" class="eui-input eui-width400" e-ignore name="city">
                                    </select>

                                </div>
                                <div class="eui-form-mid eui-word-aux"></div>
                            </div>
                            <div class="eui-form-item">
                                <label class="eui-form-label">区</label>
                                <div class="eui-input-inline">
                                    <select data-province="" id="district" class="eui-input eui-width400" e-ignore name="district">
                                    </select>

                                </div>
                                <div class="eui-form-mid eui-word-aux"></div>
                            </div>
                            </div>


                            <div class="eui-form-item">
                                <label class="eui-form-label">详细地址</label>
                                <div class="eui-input-inline">
                                    <input th:value="${session.userSession.addr}" type="text" name="addr"   class="eui-input eui-width400">
                                </div>
                                <div class="eui-form-mid eui-word-aux"></div>
                            </div>

                            <div class="eui-form-item">
                                <label class="eui-form-label"></label>
                                <div class="eui-input-inline">
                                    <button   type="submit"   class="eui-btn eui-btn-small eui-btn-normal">
                                        保存修改
                                    </button>
                                </div>
                                <div class="eui-input-inline">
                                    <a id="errcode0"></a>
                                </div>

                            </div>
                        </div>
                    </form>

                    <div style="width: 33%;float: right;" class="eui-paddingT20">
                        <p class="eui-marginB10">
                            <button type="button" class="eui-btn eui-btn-small eui-btn-normal" id="upFiles"><i class="eui-icon">&#xe67c;</i>上传图片
                        </button>
                        </p>
                        <p class="eui-font12">(只支持图片上传,支持jpg,png)</p>
                    </div>

                    <div style="width: 33%;float: right;" class="eui-marginT10">
                        <div style="width: 100px; height: 100px; float: left;">
                            <img id="headImg" th:src="${'/files'+session.userSession.headImg+'?t='+'javascript:Math.random()'}" width="90" height="90">
                        </div>
                    </div>


                    <div style="width: 33%;float: right;" class="eui-paddingT20">
                        <p class="eui-marginB10">
                            <button type="button" class="eui-btn eui-btn-small eui-btn-normal" onclick="openConversation()" id="upCertification"><i class="eui-icon">&#xe67c;</i>资质认证上传
                            </button>
                        </p>
                        <p class="eui-font12" id="userCertification">(请上传资质证明的相关材料,只支持图片上传,支持jpg,png)</p>
                    </div>

                    <div style="width: 33%;float: right;" class="eui-marginT10">
                        <div style="width: 100px; height: 100px; float: left;">
                            <img id="certificationImg" th:src="${'/files'+session.userSession.certification+'?t='+'javascript:Math.random()'}" width="90" height="90">
                        </div>
                    </div>

                </div>
            </div>


            <!--图片上传框-->
            <div  class="am-modal am-modal-no-btn up-frame-bj " tabindex="-1" id="doc-modal-1">
                <div class="am-modal-dialog up-frame-parent up-frame-radius">
                    <div class="am-modal-hd up-frame-header">
                        <label style="color: #1E9FFF">上传图片</label>
                        <a href="javascript: void(0)" class="am-close am-close-spin" data-am-modal-close>&times;</a>
                    </div>
                    <div class="am-modal-bd  up-frame-body">
                        <div class="am-g am-fl">
                            <div class="am-form-group am-form-file">
                                <div class="am-fl">
                                    <button type="button" class="eui-btn eui-btn-small eui-btn-normal">
                                        <i class="eui-icon">&#xe67c;</i> 选择要上传的图片</button>
                                </div>
                                <input type="file" id="inputImage">
                            </div>
                        </div>
                        <div class="am-g am-fl" >
                            <div class="up-pre-before up-frame-radius">
                                <img alt="" src="" id="image" >
                            </div>
                            <div class="up-pre-after up-frame-radius">
                            </div>
                        </div>
                        <div class="am-g am-fl">
                            <div  style="background: center;" class="up-control-btns">
                                <a  class="eui-btn eui-btn-small  eui-btn-normal" id="up-btn-ok" url="/upload/upload/cropHeadImg">保存修改</a>
                            </div>
                        </div>

                    </div>
                </div>
            </div>


        </div>
    </div>
    <div th:replace="project/cube/common/footer :: footer">footer</div>

</div>
<script type="text/javascript" src="/Scripts/jquery-1.9.0.min.js"></script>
<script src="/Scripts/module/eui.js" charset="utf-8"></script>
<script src="/Scripts/main.js" charset="utf-8"></script>



<script src="/Scripts/libs/ligerUI/js/ligerui.all.js" type="text/javascript"></script>
<script src="/pack.ajax.js" type="text/javascript"></script>
<script src="/Scripts/date2format.js" type="text/javascript"></script>
<script src="/Scripts/plugins/jquery.validate.js"></script>
<script src="/Scripts/plugins/amazeui.min.js"></script>
<script src="/Scripts/plugins/cropper.min.js"></script>
<script src="/Scripts/plugins/custom_up_img.js"></script>
<script type="text/javascript" th:src="@{/Scripts/cube/header.js}"></script>
<script src="/Scripts/plugins/distpicker.data.js"></script>
<script src="/Scripts/plugins/distpicker.js"></script>
<script th:inline="javascript">
    /*<![CDATA[*/
    var updateObj  =[[${session.userSession}]];
    /*]]>*/
    var iframeWin = '';
function openConversation() {
    var index = layer.open({
        title: '阅读上传资质证明'
        , type: 2
        , area: ['500px', '350px']
        ,closeBtn: 0
        , content: '/web/customer/certificationData',
        success: function(layero, index){
            var body = layer.getChildFrame('body', index);
             iframeWin = window[layero.find('iframe')[0]['name']]; //得到iframe页的窗口对象，执行iframe页的方法：iframeWin.method();

        }
    });
}
//    eui.use('upload', function(){
//        var $ = eui.jquery
//            ,upload = eui.upload;
//
//        var uploadInst = upload.render({
//            elem: iframeWin.findElementById('r')
//            ,url: '/upload/uploadCertification'
//            ,before: function(obj){
//                //预读本地文件示例，不支持ie8
//                obj.preview(function(index, file, result){
//                    $('#certificationImg').attr('src', result); //图片链接（base64）
//                });
//            }
//            ,done: function(res){
//                //如果上传失败
//                if(res.code > 0){
//                    return layer.msg('上传失败');
//                }
//                //上传成功
//                layer.msg('上传成功');
//                $('#userCertification').text('(已上传资质证明的材料，审核中)');
//            }
//            ,error: function(){
//                //演示失败状态，并实现重传
//                layer.msg('上传出错');
//
//            }
//        });
//
//    });
    $.post("/upload/findCertification", {}, function (result) {
        if (result.code == 200) {
            if (result.data.certification != null && result.data.certificationStatus == 2 && result.data.certification != ''){
                $('#userCertification').text('(已上传资质证明的材料，审核中)');
                layer.closeAll();
            }else if (result.data.certificationStatus == 1){
                $('#userCertification').text('(已通过审核)');
                var DISABLED = 'eui-btn-disabled';
                $("#upCertification").attr("disabled", true);
                $('#upCertification').addClass(DISABLED);
                layer.closeAll();
            }

        } else {

        }
    });

function closeChildWindow() {
    layer.closeAll();
}

function dealImg(result) {
    $('#certificationImg').attr('src', result); //图片链接（base64）
}
function dealText() {
    layer.msg('上传成功');
    $('#userCertification').text('(已上传资质证明的材料，审核中)');
}
//function timeout() {
//   sure = true;
//   alert(1);
//    eui.use('upload', function(){
//        var $ = eui.jquery
//            ,upload = eui.upload;
//alert(2);
//        if(sure){
//            alert(3);
//            layer.closeAll();
//            $("#upCertification").trigger("click");
//        }
//    });
//
//}
</script>

<script>
    // 表单
    eui.use(['form', 'layedit', 'laydate', 'laypage', 'layer'], function () {
        var form = eui.form
            , layer = eui.layer
            , layedit = eui.layedit
            , laydate = eui.laydate
            , laypage = eui.laypage;

        $('#province').val(updateObj .province);
        $('#province').trigger("change");

        $('#city').val(updateObj .city);
        $('#city').trigger("change");

        $('#district').val(updateObj .district);
        $('#district').trigger("change");
    });

    $(function () {
        $("#userInfoForm").validate({
            submitHandler: function() {
                $("#error0").html('');
                if ($("#userInfoForm input[name='userName']").val()!=''){
                    var obj = $("#userInfoForm").serializeObject();
                    $.post('/user/userUpdate',{json:JSON.stringify(obj)},function (result) {
                        if (result.code ==200){
                            $("#userName").html(obj.userName)
                        }
                        layer.msg(result.message);
                    });
                }else {
                    layer.msg('用户名不能为空')
                }

            }
        });
    });
</script>
</body>
</html>