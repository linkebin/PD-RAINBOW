<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en"  xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <meta charset="UTF-8">
    <title>来访者咨询管理</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/Styles/themes/default/style.css" rel="stylesheet" type="text/css" />
    <style>
        input[type='text']{height: 30px; line-height: 30px;}
        .eui-form-label{padding: 5px 15px;}
        .eui-btn-smallmin {
            height: 26px;
            line-height: 26px;
            padding: 0 10px;
            font-size: 12px;
        }
        .consultSheet .eui-icon {
           background: none;
        }
        #shaftTime  li{cursor: pointer;}

        .customerList .line{cursor: pointer;
        }

        .customerList .line:hover{
            background: #4bb2ff;
        }

        #DivAddForm textarea + label{color: red;}
        .tb{cursor: pointer;margin-left: 15px;}

    </style>
</head>
<body>
<div class="questionHeader">
    <div class="eui-row eui-area">
        <div class="xymfLogo eui-col-md6">
            <img src="../../Styles/images/xymfImages/xymf/logo.png" alt="">
            <span class="payCentre">来访者咨询管理</span>
        </div>
        <div class="eui-col-md6 eui-textAlignR">
            <span onclick="resetCustomer()" class="eui-btn switch eui-btn-big eui-btn-normal eui-marginT5">切换来访者</span>
        </div>
    </div>
</div>

<div class="visitorContent xymfMargin">
    <div class="eui-area">
        <div class="visitorTitle">
            <div class="eui-row">
                <div class="eui-col-md3 eui-paddingT10">
                    <th:block th:if="${visitorRegister.sex==0}">
                        <img src="/Styles/images/xymfImages/woman.png" width="30" alt="">&nbsp;&nbsp;
                    </th:block>
                    <th:block th:if="${visitorRegister.sex==1}">
                        <img src="/Styles/images/xymfImages/man.png" width="30" alt="">&nbsp;&nbsp;
                    </th:block>

                    <a target="_blank" th:text="${visitorRegister.visitorName}"
                       th:href="'/web/customer/visitorUpdate?id='+${visitorRegister.id}" class="eui-color-blue"></a>
                </div>
                <div class="eui-col-md1 eui-paddingT20 eui-color-gray3"></div>
                <div class="eui-col-md8 eui-textAlignR">
                    <span class="eui-btn eui-btn-normal" onclick="addVisitorRecord()">
                <i style="cursor: pointer;" class="eui-icon eui-font12"> &#xe654; </i>来访记录 </span>
                </div>
            </div>

        </div>

        <div class="eui-area eui-bd eui-bg-white">
            <div style="width: 120px;" class="eui-sd1 eui-sd1-type1">

                <ul id="shaftTime" class="eui-timeline eui-font14 eui-marginL10 eui-marginT20">

                </ul>
            </div>
            <div style="width: 98%;" class="eui-mn1">
                <div class="eui-mn1-type1 eui-padding20 eui-bg-white eui-box-shadow">
                    <form  id="searchFrom">
                        <input type="hidden" name="visitorId" th:value="${id}" />
                        <!--<div class="eui-form">-->
                        <!--<div class="eui-form-item">-->
                        <!--<label class="eui-form-label">开始时间</label>-->
                        <!--<div class="eui-input-inline">-->
                        <!--<input type="text" name="startTime" id="startTime" readonly="readonly"  placeholder="" class="eui-input">-->
                        <!--</div>-->

                        <!--<label class="eui-form-label">截至时间</label>-->
                        <!--<div class="eui-input-inline">-->
                        <!--<input type="text" name="endTime" id="endTime" readonly="readonly"  placeholder="" class="eui-input">-->
                        <!--</div>-->
                        <!--<div class="eui-input-inline">-->
                        <!--<span class="eui-btn eui-btn-small" onclick="doSearch()">查询</span>-->
                        <!--<span class="eui-btn eui-btn-small eui-btn-primary" onclick="resetForm()">重置</span>-->
                        <!--</div>-->
                        <!--</div>-->

                        <!--</div>-->
                    </form>
                    <div class="DivInfo">
                        <p><i class="eui-icon">&#xe60e;</i>
                            <span class="eui-font16">记录时间</span>
                            <span  class="eui-marginL15 createTime"></span></p>

                        <p class="eui-marginT10"><i class="eui-icon">&#xe606;</i>
                            <span class="eui-font16">来访时间</span>
                            <span  class="eui-marginL15 visitorTime"></span>
                        </p>
                        <div class="eui-marginT10 eui-row">
                            <div class="eui-col-md1 eui-marginT5 eui-font16 eui-marginR15"><i class="eui-icon">&#xe63c;</i> 问卷填写 </div>


                            <div class="eui-col-md2 eui-marginL20" id="addQuestionnaire" onclick="loadQuestionnaire()">
                             <span id="noData" class="eui-btn eui-btn-small eui-btn-normal">
                                    <i class="eui-icon">&#xe654;</i> 新增问卷
                        </span>
                            </div>
                        </div>
                        <div class="eui-marginT20 eui-form">
                            <p class="eui-font16 eui-paddingB10 eui-borderB"><img src="/Styles/images/xymfImages/cloud.png" alt=""> 来访目的</p>
                            <p id="visitingPurpose" class="eui-marginT20 eui-lineHeight24">
                            </p>
                        </div>
                        <div class="eui-marginT20 eui-form">
                            <p class="eui-font16 eui-paddingB10 eui-borderB"><img src="/Styles/images/xymfImages/cloud.png" alt=""> 过程记录</p>
                            <p id="processLog" class="eui-marginT20 eui-lineHeight24">
                            </p>
                        </div>
                        <div class="eui-marginT20 eui-form">
                            <p class="eui-font16 eui-paddingB10 eui-borderB"><img src="/Styles/images/xymfImages/cloud.png" alt=""> 后续计划</p>
                            <p id="followUpPlan" class="eui-marginT20 eui-lineHeight24">
                            </p>
                        </div>
                        <div class="eui-marginT20 eui-form">
                            <p class="eui-font16 eui-paddingB10 eui-borderB"><img src="/Styles/images/xymfImages/cloud.png" alt=""> 备注</p>
                            <p id="remarks" class="eui-marginT20 eui-lineHeight24">
                            </p>
                        </div>

                    </div>

                    <form id="DivAddForm" onsubmit="return false;">
                        <input type="hidden" name="visitorId" th:value="${id}" />
                        <div style="display: none;" class="DivAdd">
                            <!--<p><i class="eui-icon">&#xe60e;</i>-->
                            <!--<span class="eui-font16">记录时间</span>-->
                            <!--<span id="datecre" style="margin-left: 24px;"></span></p>-->

                            <p style="float: left;" class="">
                                <i class="eui-icon">&#xe606;</i>
                                <span class="eui-font16">来访时间</span>
                            <div style=" float: left; margin-left: 12px; margin-top: -5px; ">
                                <input type="text" readonly="readonly" name="visitorTime" id="visitorTime"
                                       class="eui-input eui-width200">
                            </div>
                            </p>
                            <div class="eui-marginT10 eui-row">
                                <!-- <div class="eui-col-md1 eui-marginT5 eui-font16 eui-marginR15"><i class="eui-icon">&#xe63c;</i> 问卷填写 </div>
                                 &lt;!&ndash;<div class="eui-col-md3 consultSheet eui-marginR10">症状自评量表-SCL90 <i class="eui-icon eui-cursorp eui-bg-gray3">&#xe621;</i><i class="eui-icon eui-bg-gray3 eui-cursorp">&#xe7d0;</i></div>&ndash;&gt;
                                 &lt;!&ndash;<div class="eui-col-md3 consultSheet eui-marginR20">症状自评量表-SCL90&ndash;&gt;
                                     &lt;!&ndash;<i class="eui-icon eui-bg-gray3 eui-cursorp">&#xe621;</i><i class="eui-icon eui-bg-gray3 eui-cursorp">&#xe7d0;</i>&ndash;&gt;
                                 &lt;!&ndash;</div>&ndash;&gt;
                                 <div class="eui-col-md2" onclick="loadQuestionnaire()">
                                     <span class="eui-btn eui-btn-small"><i class="eui-icon">&#xe654;</i> 新增问卷</span>
                                 </div>-->
                            </div>
                            <div class="eui-marginT20 eui-form">
                                <p class="eui-font16 eui-paddingB10 eui-borderB"><img src="/Styles/images/xymfImages/cloud.png" alt=""> 来访目的</p>
                                <p class="eui-marginT20 eui-lineHeight24">
                                    <textarea name="visitingPurpose" placeholder="来访目的" class="eui-textarea"></textarea>
                                </p>
                            </div>
                            <div class="eui-marginT20 eui-form">
                                <p class="eui-font16 eui-paddingB10 eui-borderB"><img src="/Styles/images/xymfImages/cloud.png" alt=""> 过程记录</p>
                                <p class="eui-marginT20 eui-lineHeight24">
                                    <textarea name="processLog" placeholder="过程记录" class="eui-textarea"></textarea>
                                </p>
                            </div>
                            <div class="eui-marginT20 eui-form">
                                <p class="eui-font16 eui-paddingB10 eui-borderB"><img src="/Styles/images/xymfImages/cloud.png" alt=""> 后续计划</p>
                                <p class="eui-marginT20 eui-lineHeight24">
                                    <textarea name="followUpPlan" placeholder="后续计划" class="eui-textarea"></textarea>
                                </p>
                            </div>
                            <div class="eui-marginT20 eui-form">
                                <p class="eui-font16 eui-paddingB10 eui-borderB"><img src="/Styles/images/xymfImages/cloud.png" alt=""> 备注</p>
                                <p class="eui-marginT20 eui-lineHeight24">
                                    <textarea name="remarks" placeholder="备注" class="eui-textarea"></textarea>
                                </p>
                            </div>
                            <input type="submit" style="display: none;" id="DivAddFormSub"/>
                        </div>
                    </form>
                    <input type="hidden" id="recordId" />
                    <div id="fileDiv" style="display: none;" class="eui-marginT20 eui-form">
                        <p class="eui-font16 eui-paddingB10 eui-borderB eui-marginB20"><img src="/Styles/images/xymfImages/cloud.png" alt=""> 附件上传</p>
                        <button type="button" class="eui-btn eui-btn-small eui-btn-normal" id="test1">
                            <i class="eui-icon">&#xe67c;</i>上传附件
                        </button>
                        <div class="eui-upload-list">
                            <table class="eui-table">
                                <thead>
                                <tr>
                                    <th>文件名</th>
                                    <th>上传时间</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody id="demoList">
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div style="display: none;" id="resetDiv" onclick="saveData();" class="eui-textAlignC eui-marginT20">
                        <span class="eui-btn eui-btn-big eui-btn-normal">提交保存</span>
                    </div>

                </div>
            </div>
        </div>

    </div>
</div>


<!--<div class="consuletant eui-bg-white">
    <div class="eui-area eui-row">
        <div class="eui-col-md3 eui-paddingT10">
            <th:block th:if="${visitorRegister.sex==0}">
                <img src="/Styles/images/xymfImages/woman.png" width="30" alt="">&nbsp;&nbsp;
            </th:block>
            <th:block th:if="${visitorRegister.sex==1}">
                <img src="/Styles/images/xymfImages/man.png" width="30" alt="">&nbsp;&nbsp;
            </th:block>

            <a target="_blank"  th:text="${visitorRegister.visitorName}"
               th:href="'/web/customer/visitorUpdate?id='+${visitorRegister.id}"></a>
        </div>
        <div class="eui-col-md1 eui-paddingT20 eui-color-gray3"></div>
        <div style="display: none;" id="resetDiv" onclick="saveData();" class="eui-col-md2 eui-col-md-offset4 eui-textAlignR">
            <span class="submitBtn eui-margin0"><img src="/Styles/images/xymfImages/submit.png" width="30" alt="">提交保存</span>
        </div>
    </div>
</div>-->

<!--<div class="consuletContent eui-padding20">
    <div class="eui-area eui-bd">
        <div style="width: 120px;" class="eui-sd1 eui-sd1-type1">
            <span class="eui-btn eui-btn-small eui-btn-normal" onclick="addVisitorRecord()">
                <i style="cursor: pointer;" class="eui-icon eui-font12"> &#xe654; </i>来访记录 </span>
            <ul id="shaftTime" class="eui-timeline eui-font14 eui-marginT10">

            </ul>
        </div>
        <div style="width: 98%;" class="eui-mn1">
            <div class="eui-mn1-type1 eui-padding20 eui-bg-white eui-box-shadow">
                <form  id="searchFrom">
                    <input type="hidden" name="visitorId" th:value="${id}" />
                    &lt;!&ndash;<div class="eui-form">&ndash;&gt;
                        &lt;!&ndash;<div class="eui-form-item">&ndash;&gt;
                            &lt;!&ndash;<label class="eui-form-label">开始时间</label>&ndash;&gt;
                            &lt;!&ndash;<div class="eui-input-inline">&ndash;&gt;
                                &lt;!&ndash;<input type="text" name="startTime" id="startTime" readonly="readonly"  placeholder="" class="eui-input">&ndash;&gt;
                            &lt;!&ndash;</div>&ndash;&gt;

                            &lt;!&ndash;<label class="eui-form-label">截至时间</label>&ndash;&gt;
                            &lt;!&ndash;<div class="eui-input-inline">&ndash;&gt;
                                &lt;!&ndash;<input type="text" name="endTime" id="endTime" readonly="readonly"  placeholder="" class="eui-input">&ndash;&gt;
                            &lt;!&ndash;</div>&ndash;&gt;
                            &lt;!&ndash;<div class="eui-input-inline">&ndash;&gt;
                                &lt;!&ndash;<span class="eui-btn eui-btn-small" onclick="doSearch()">查询</span>&ndash;&gt;
                                &lt;!&ndash;<span class="eui-btn eui-btn-small eui-btn-primary" onclick="resetForm()">重置</span>&ndash;&gt;
                            &lt;!&ndash;</div>&ndash;&gt;
                        &lt;!&ndash;</div>&ndash;&gt;

                    &lt;!&ndash;</div>&ndash;&gt;
                </form>
             <div class="DivInfo">
                <p><i class="eui-icon">&#xe60e;</i>
                    <span class="eui-font16">记录时间</span>
                    <span  class="eui-marginL15 createTime"></span></p>

                <p class="eui-marginT10"><i class="eui-icon">&#xe606;</i>
                    <span class="eui-font16">来访时间</span>
                    <span  class="eui-marginL15 visitorTime"></span>
                </p>
                <div class="eui-marginT10 eui-row">
                    <div class="eui-col-md1 eui-marginT5 eui-font16 eui-marginR15"><i class="eui-icon">&#xe63c;</i> 问卷填写 </div>


                    <div class="eui-col-md2 eui-marginL20" id="addQuestionnaire" onclick="loadQuestionnaire()">
                        <span id="noData" class="eui-btn eui-btn-small eui-btn-normal">
                            <i class="eui-icon">&#xe654;</i> 新增问卷
                        </span>
                    </div>
                </div>
                <div class="eui-marginT20 eui-form">
                    <p class="eui-font16 eui-paddingB10 eui-borderB"><img src="/Styles/images/xymfImages/cloud.png" alt=""> 来访目的</p>
                    <p id="visitingPurpose" class="eui-marginT20 eui-lineHeight24">
                    </p>
                </div>
                <div class="eui-marginT20 eui-form">
                    <p class="eui-font16 eui-paddingB10 eui-borderB"><img src="/Styles/images/xymfImages/cloud.png" alt=""> 过程记录</p>
                    <p id="processLog" class="eui-marginT20 eui-lineHeight24">
                    </p>
                </div>
                <div class="eui-marginT20 eui-form">
                    <p class="eui-font16 eui-paddingB10 eui-borderB"><img src="/Styles/images/xymfImages/cloud.png" alt=""> 后续计划</p>
                    <p id="followUpPlan" class="eui-marginT20 eui-lineHeight24">
                    </p>
                </div>
                <div class="eui-marginT20 eui-form">
                    <p class="eui-font16 eui-paddingB10 eui-borderB"><img src="/Styles/images/xymfImages/cloud.png" alt=""> 备注</p>
                    <p id="remarks" class="eui-marginT20 eui-lineHeight24">
                    </p>
                </div>

             </div>

                <form id="DivAddForm" onsubmit="return false;">
                    <input type="hidden" name="visitorId" th:value="${id}" />
                    <div style="display: none;" class="DivAdd">
                        &lt;!&ndash;<p><i class="eui-icon">&#xe60e;</i>&ndash;&gt;
                            &lt;!&ndash;<span class="eui-font16">记录时间</span>&ndash;&gt;
                            &lt;!&ndash;<span id="datecre" style="margin-left: 24px;"></span></p>&ndash;&gt;

                        <p style="float: left;" class="">
                            <i class="eui-icon">&#xe606;</i>
                            <span class="eui-font16">来访时间</span>
                            <div style=" float: left; margin-left: 12px; margin-top: -5px; ">
                                <input type="text" readonly="readonly" name="visitorTime" id="visitorTime"
                                       class="eui-input eui-width200">
                            </div>
                        </p>
                        <div class="eui-marginT10 eui-row">
                           &lt;!&ndash; <div class="eui-col-md1 eui-marginT5 eui-font16 eui-marginR15"><i class="eui-icon">&#xe63c;</i> 问卷填写 </div>
                            &lt;!&ndash;<div class="eui-col-md3 consultSheet eui-marginR10">症状自评量表-SCL90 <i class="eui-icon eui-cursorp eui-bg-gray3">&#xe621;</i><i class="eui-icon eui-bg-gray3 eui-cursorp">&#xe7d0;</i></div>&ndash;&gt;
                            &lt;!&ndash;<div class="eui-col-md3 consultSheet eui-marginR20">症状自评量表-SCL90&ndash;&gt;
                                &lt;!&ndash;<i class="eui-icon eui-bg-gray3 eui-cursorp">&#xe621;</i><i class="eui-icon eui-bg-gray3 eui-cursorp">&#xe7d0;</i>&ndash;&gt;
                            &lt;!&ndash;</div>&ndash;&gt;
                            <div class="eui-col-md2" onclick="loadQuestionnaire()">
                                <span class="eui-btn eui-btn-small"><i class="eui-icon">&#xe654;</i> 新增问卷</span>
                            </div>&ndash;&gt;
                        </div>
                        <div class="eui-marginT20 eui-form">
                            <p class="eui-font16 eui-paddingB10 eui-borderB"><img src="/Styles/images/xymfImages/cloud.png" alt=""> 来访目的</p>
                            <p class="eui-marginT20 eui-lineHeight24">
                                <textarea name="visitingPurpose" placeholder="来访目的" class="eui-textarea"></textarea>
                            </p>
                        </div>
                        <div class="eui-marginT20 eui-form">
                            <p class="eui-font16 eui-paddingB10 eui-borderB"><img src="/Styles/images/xymfImages/cloud.png" alt=""> 过程记录</p>
                            <p class="eui-marginT20 eui-lineHeight24">
                                <textarea name="processLog" placeholder="过程记录" class="eui-textarea"></textarea>
                            </p>
                        </div>
                        <div class="eui-marginT20 eui-form">
                            <p class="eui-font16 eui-paddingB10 eui-borderB"><img src="/Styles/images/xymfImages/cloud.png" alt=""> 后续计划</p>
                            <p class="eui-marginT20 eui-lineHeight24">
                                <textarea name="followUpPlan" placeholder="后续计划" class="eui-textarea"></textarea>
                            </p>
                        </div>
                        <div class="eui-marginT20 eui-form">
                            <p class="eui-font16 eui-paddingB10 eui-borderB"><img src="/Styles/images/xymfImages/cloud.png" alt=""> 备注</p>
                            <p class="eui-marginT20 eui-lineHeight24">
                                <textarea name="remarks" placeholder="备注" class="eui-textarea"></textarea>
                            </p>
                        </div>
                        <input type="submit" style="display: none;" id="DivAddFormSub"/>
                    </div>
                </form>
                <input type="hidden" id="recordId" />
                <div id="fileDiv" style="display: none;" class="eui-marginT20 eui-form">
                    <p class="eui-font16 eui-paddingB10 eui-borderB eui-marginB20"><img src="/Styles/images/xymfImages/cloud.png" alt=""> 附件上传</p>
                    <button type="button" class="eui-btn eui-btn-small eui-btn-normal" id="test1">
                        <i class="eui-icon">&#xe67c;</i>上传附件
                    </button>
                    <div class="eui-upload-list">
                        <table class="eui-table">
                            <thead>
                            <tr>
                                <th>文件名</th>
                                <th>上传时间</th>
                                <th>操作</th>
                            </tr>
                            </thead>
                            <tbody id="demoList">
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>-->

<div class="xymfFooter">
    <!-- 底部固定区域 -->
    © 2017 广州市易度软件开发有限公司旗下心云魔方品牌
</div>

<!-- 右滑高级筛选开始 -->
<div class="eui-slipBg">
</div>
<div style="overflow: scroll" class="eui-slipContent">
    <div class="eui-row eui-padding10 eui-borderB">
        <div class="eui-col-md2 eui-marginT5">客户姓名</div>
        <div class="eui-col-md10">
            <input type="hidden" id="creator" th:value="${session.userSession.id}" />
            <input type="text" id="visitorName" autocomplete="off" placeholder="输入来客户姓名搜索" class="eui-input">
        </div>
    </div>

    <div class="customerList">

    </div>

</div>
<!-- 右滑高级筛选结束 -->



<!-- 返回顶部按钮 -->
<span class="eui-icon eui-backTop" e-type="top">&#xe604;</span>

<script src="/Scripts/module/eui.js"></script>
<script type="text/javascript" src="/Scripts/jquery-1.9.0.min.js"></script>

<script src="/pack.ajax.js" type="text/javascript"></script>
<script src="/Scripts/date2format.js" type="text/javascript"></script>
<script src="/Scripts/plugins/jquery.validate.js"></script>

<script>
    eui.use(['form', 'layedit', 'laydate'], function(){
        var form = eui.form
            ,layer = eui.layer
            ,layedit = eui.layedit
            ,laydate = eui.laydate;

        laydate.render({
            elem: '#startTime'
        });
        laydate.render({
            elem: '#endTime'
        });
        laydate.render({
            elem: '#visitorTime'
            ,type: 'datetime'
        });
    })

// 返回顶部
var winH = $(window).height();

$('.eui-backTop').hide();
$(window).scroll(function(e) {
    var winT = $(window).scrollTop();
    if(winT>winH){
        $('.eui-backTop').fadeIn()
    }else{
        $('.eui-backTop').fadeOut()
    }
});

$('.eui-backTop').click(function(e) {
    $('html,body').animate({scrollTop:0},500)
});



// 高级筛选左滑
//$(".eui-slipBg").hide();
//$(".switch").click(function(event) {
//    $(".eui-slipBg").show();
//    $(".eui-slipContent-left").animate({right:'0'},400);
//});
//
//$(".eui-iconClose,.eui-slipBg,.eui-slipConfirm").click(function(event) {
//    $(".eui-slipContent-left").animate({right:'-400px'},400);
//    $(".eui-slipBg").hide();
//});

    $(".eui-slipBg").hide();
    $(".switch").click(function(event) {
        $(".eui-slipBg").show();
        $(".eui-slipContent").animate({right:'0'},400);
    });
    $(".eui-leftSlip").click(function(event) {
        $(".eui-slipBg").show();
        $(".eui-slipContent-left").animate({left:'0'},400);
    });

    $(".eui-iconClose,.eui-slipBg,.eui-slipConfirm").click(function(event) {
        $(".eui-slipContent").animate({right:'-400px'},400);
        $(".eui-slipContent-left").animate({left:'-400px'},400);
        $(".eui-slipBg").hide();
    });


$(function () {
    loadShaftTime();
    $('#visitorName').bind('input propertychange', function() {
        var textValue = $(this).val();
        var params = new Object();
        params.creator=$("#creator").val();
        params.visitorName=textValue;
        loadCustomerList(params);
    });



    $("#DivAddForm").validate({
        rules: {
            visitorTime: {
                required : true,
            },
            visitingPurpose:{
                required : true,
            },
            processLog: {
                required: true,
            },
            followUpPlan: {
                required: true,
            }
        },
        messages: {
            visitorTime: {
                required : "请选择来访时间",
            },
            visitingPurpose:{
                required : '请输入来访目的',
            },
            processLog: {
                required: '请输入过程记录',
            },
            followUpPlan: {
                required: '请输入后续计划',
            }
        },
        submitHandler: function() {
            var obj = $("#DivAddForm").serializeObject();
            $.post('/visiting/record/add',{json:JSON.stringify(obj)},function (result) {
                if (result.code==200){
                    location.reload();
                }else {
                    layer.msg(result.message);
                }
            });
        }
    });

});
function resetCustomer() {
    var params = new Object();
    params.creator=$("#creator").val();
    params.visitorName='';
    loadCustomerList(params);
}
function loadCustomerList(params) {
    $.post('/visitor/register/listByparameter',{
        json:JSON.stringify(params),
        page:1,
        pagesize:100000
    },function (result) {
        $(".customerList").html('');
        console.log(result.data.list)
        var list = result.data.list;
        $.each(list,function (index,item) {

            var img = '/Styles/images/xymfImages/woman.png';
            if (item.sex == 1){
                img='/Styles/images/xymfImages/man.png'
            }

            $(".customerList").append('<div visitorId="'+item.id+'" class="eui-row  eui-padding10 line"> ' +
                '<div class="eui-col-md8 eui-lineHeight24"> ' +
                '<p> <span class="eui-font16">'+item.visitorName+'</span></p> ' +
                '' +
                '</div> ' +
                '<div class="eui-col-md2 eui-textAlignR">' +
                '<img src="'+img+'" width="20" alt=""></div> ' +
                '</div>')
        });
        $(".customerList .line").click(function () {
            location.href='/web/customer/visitorInfo?id='+$(this).attr('visitorId');
        });
    });
}

function loadShaftTime() {
    var obj = $("#searchFrom").serializeObject();
    $.post('/visiting/record/shaftTime',{json:JSON.stringify(obj)},function (result) {
        var list = result.data.list;
        if (list.length>0){
            $.each(list, function (index, item) {
                $('#shaftTime').append('<li visitorId="'+item.id+'" class="eui-timeline-item"> ' +
                    '<div class="eui-timeline-content eui-text"> ' +
                    '<div class="eui-timeline-title">'+new Date(item.visitorTime).Format('yyyy-MM-dd')+'</div> ' +
                    '</div> ' +
                    '<i class="eui-icon eui-timeline-axis">&#xe63f;</i> ' +
                    '</li>');
            });
            loadVisitorRecordDetail(list[0].id);

            $("#shaftTime li").find('i').eq(0).html('&#xe617;');

            $("#shaftTime li").click(function () {
                $('#resetDiv').hide();
                var id = $(this).attr('visitorId');
                loadVisitorRecordDetail(id);
                $("#shaftTime li").find('i').html('&#xe63f;');
                $(this).find('i').html('&#xe617;')
            });
        }else {
            $('#noData').hide();
        }
    });
}
    var visitorTimes="";
function loadVisitorRecordDetail(id) {

    $("#fileDiv").show();
    $("#searchFrom").show();
    $(".DivInfo").show();
    $(".DivAdd").hide();
    $("#recordId").val(id);
    $.post('/visiting/record/detail',{id:id},function (result) {

        var obj = result.data;
        $(".DivInfo #visitingPurpose").html(obj.visitingPurpose);
        $(".DivInfo #processLog").html(obj.processLog);
        $(".DivInfo #followUpPlan").html(obj.followUpPlan);
        $(".DivInfo #remarks").html(obj.remarks);
        $(".DivInfo .createTime").html(new Date(obj.createTime)
            .Format('yyyy-MM-dd hh:mm:ss'));

        $(".DivInfo .visitorTime").html(new Date(obj.visitorTime)
            .Format('yyyy-MM-dd hh:mm:ss'));
        var visitingRecordFileList = obj.visitingRecordFileList;
        $("#demoList").html('');
        $.each(visitingRecordFileList,function (index,item) {
            $("#demoList").append(' <tr> <th>'+item.fileName+'</th> <th>'
                +new Date(item.createTime).Format('yyyy-MM-dd hh:mm:ss')+'</th>' +
                '<th class="icons"><i path="'+item.fileUri+'" title="下载" class="eui-icon tb">&#xe61e;</i>' +
                '<i path="'+item.id+'" title="删除" class="eui-icon tb">&#xe640;</i></th></tr>');
        });
        var  createTime=new Date(obj.visitorTime).Format('yyyy-MM-dd');
        visitorTimes=createTime;
        var userId=$("[name='visitorId']").val();

        $.post("/data/acquisition/findQuestionnaireForVisitor",{"userId":userId,"createTime":createTime},function (result) {
           var list=result.data;
            var coontext="";
            for(var i in list){
                coontext+='<div  name="startAnswer" acquisitionId="'+list[i].id+'" questionnaireId="'+list[i].dataQuestion+'" class="eui-col-md3 consultSheet eui-marginR10">'+list[i].questionnaireName;
                coontext+='    <i class="eui-icon">&#xe621;</i>';
                coontext+=' </div> ';
            }
            $("[name='startAnswer']").remove();
            $('#addQuestionnaire').before(coontext);
            $("[name='startAnswer']").on("click",function () {
                 var questionnaireId = $(this).attr("questionnaireId");
                 var acquisitionId = $(this).attr("acquisitionId");
                 selQuestionnaireForVisitor(questionnaireId,userId,acquisitionId);
            });


        });
        eui.use('upload', function(){
            var $ = eui.jquery
                ,upload = eui.upload;
            var uploadInst = upload.render({
                elem: '#test1'
                ,url: '/upload/upFile'
                ,accept: 'file'
                ,data: {fileTable:'visiting_record_file',
                    recordId:$("#recordId").val()}
                ,done: function(res){
                    var obj = JSON.parse(res);
                    $("#demoList").append(' <tr> <th>'+obj.fileName+'</th> <th>'
                        +new Date().Format('yyyy-MM-dd hh:mm:ss')+'</th>' +
                        '<th class="icons"><i path="'+obj.data.src+'" title="下载" class="eui-icon tb">&#xe61e;</i>' +
                        '<i path="'+obj.id+'" title="删除" class="eui-icon tb">&#xe640;</i></th></tr>');

                    $('.icons i').click(function () {
                        if ($(this).index() == 0){
                            window.open('/files'+$(this).attr('path'));
                        }else {
                            deletefile($(this).attr('path'),$(this));
                        }
                    });
                    }
                ,error: function(){
                }
            });
        });
        $('.icons i').click(function () {
            if ($(this).index() == 0){
                window.open('/files'+$(this).attr('path'));
            }else {
                deletefile($(this).attr('path'),$(this));
            }
        });
    });
}
function deletefile(id,dom) {
    $.post('/visiting/record/file/delete',{id:id},function (result) {
        if (result.code == 200) {
            $(dom).parent('.icons').parent('tr').remove();
        }else {
            layer.msg(result.message);
        }
    });
}
function addVisitorRecord() {
    $("#fileDiv").hide();
    $("#resetDiv").show();
    $("#searchFrom").hide();
    $(".DivInfo").hide();
    $(".DivAdd").show();
    $(".DivAdd input[name='visitorTime']").val(new Date().Format('yyyy-MM-dd hh:mm:ss'));
    $("#datecre").html(new Date().Format('yyyy-MM-dd hh:mm:ss'));
    $("#shaftTime li").find('i').html('&#xe63f;');
}

function saveData() {
    return $("#DivAddFormSub").click();
}
//  加载问卷
function  loadQuestionnaire() {
        var userId=$("[name='visitorId']").val();
        var list=new Array;
        eui.use(['form','layer'], function() { //独立版的layer无需执行这一句
            var $ = eui.jquery,
                layer = eui.layer,form=eui.form; //独立版的layer无需执行这一句
            var iframeWin;//iframe对象
            layer.open({
                type: 2
                ,id: 'checkQuestionnaire'
                ,title: '选择问卷'
                ,area: ['800px', '500px']
                ,success: function(layero, index){
                    var body = layer.getChildFrame('body', index);
                    iframeWin = window[layero.find('iframe')[0]['name']]; //得到iframe页的窗口对象，执行iframe页的方法：
                }
                ,shade: 0
                ,moveType: 0//拖拽模式，0或者1
                ,maxmin: true
                ,content:"/web/customer/getCheckQuestionnaire"
                ,btn: ['确定', '关闭'] //只是为了演示
                ,yes: function(){
                    //得到设置返回的结果
                    list=iframeWin.checkQuestionnaire();
                    //加载层
                    var index = layer.load(0, {shade: false}); //0代表加载的风格，支持0-2
                    //添加问卷使用
                    $.post("/cube/customer/getCheckQuestionnaireForVisitor",{},function (result) {
                        layer.closeAll();
                        if(result.code!=200){
                           // 账号余额不足
                            layer.open({
                                title:"充值",
                                type: 1,
                                content: '<div style="width: 350px;height: 350px">您的可用问卷余额不足，现在去 <a target="_blank" class="eui-btn eui-btn-normal eui-btn-small" href="/cube/pay">充值</a>！</div>'
                            });
                           /* layer.msg("您的可用余额不足，请及时充值！" ,{
                                time: 6000
                            });*/
                        }else {
                            layer.closeAll();
                            console.info("  console.info(list);");
                            console.info(list);
                            for(var i in list){
                                var questionnaireId=list[i].id;
                                startAnswer(questionnaireId,userId);
                            }
                        }
                    });

                }
                ,btn2: function(){
                    layer.closeAll();
                },cancel: function(){
                    layer.closeAll();
                }
                ,zIndex: layer.zIndex //重点1
            });
        });

    }
//查看来访者填写的问卷
    function selQuestionnaireForVisitor(questionnaireId,userId,acquisitionId){
       window.open("/web/cube/getQuestionnaireForVisitor?questionnaireId="+questionnaireId+"&userId="+userId+"&acquisitionId="+acquisitionId);
    }

   function startAnswer(questionnaireId,userId) {
       window.location.href="/web/cube/getQuestionnaireFillIn?questionnaireId="+questionnaireId+"&userId="+userId+"&visitorTimes="+visitorTimes;
   }
</script>

</body>
</html>
