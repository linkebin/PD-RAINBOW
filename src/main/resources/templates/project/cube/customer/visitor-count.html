<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>来访统计</title>
    <link rel="stylesheet" th:href="@{/Styles/themes/default/style.css}" media="all">
</head>
<body class="eui-layout-body">
<div class="eui-layout eui-layout-admin xymfHome">
    <div th:replace="project/cube/common/header :: header(${3})">Header</div>
    <div class="eui-bd eui-area eui-marginT10 chartsPage">
        <div class="eui-sd1 eui-sd1-type3">
            <div class="chartsLeft eui-bg-white chartsShadow eui-margin10 eui-marginT0">
                <div class="eui-bg-blue eui-padding10">
                    <div class="eui-row">
                        <div class="eui-col-md6 eui-font18">按指标查询</div>
                        <div class="eui-col-md6 eui-paddingT5 eui-textAlignR">
                            <p class="collect"><span class="eui-icon">&#xe600;</span> 收藏模版</p>
                        </div>
                    </div>
                    <div class="eui-marginT20 eui-form">
                        <select name="city" e-verify="required">
                            <option value="010" selected="">请选择模版</option>
                            <option value="012">模版一</option>
                            <option value="0571">模版二</option>
                        </select>
                    </div>
                </div>
                <ul class="eui-form eui-paddingB10 eui-paddingLR10 filter">
                    <!--<li>
                        <div class="eui-form-item chartsTitle">
                            <label class="eui-form-label eui-textAlignL">区域</label>
                            <div class="eui-input-block eui-textAlignR eui-paddingR10">
                                <input type="checkbox" name="like[write]" e-skin="primary" title="" checked="">
                            </div>
                        </div>
                        <ul class="chartsContent region">
                            <li class="eui-form-item">
                                <label class="eui-form-label eui-textAlignL">区域1</label>
                                <div class="eui-input-block eui-textAlignR eui-paddingR10">
                                    <input type="checkbox" name="like[write]" e-skin="primary" title="">
                                </div>
                            </li>
                        </ul>
                    </li>-->
                    <li>
                        <div class="eui-form-item chartsTitle">
                            <label class="eui-form-label eui-textAlignL">问卷类型</label>
                            <div class="eui-input-block eui-textAlignR eui-paddingR10">
                                <input type="checkbox" e-skin="primary" title="" checked="">
                            </div>
                        </div>
                        <ul class="chartsContent" id="type">
                        </ul>
                    </li>
                    <li>
                        <div class="eui-form-item chartsTitle">
                            <label class="eui-form-label eui-textAlignL">性别</label>
                            <div class="eui-input-block eui-textAlignR eui-paddingR10">
                                <input type="checkbox" name="like[write]" e-skin="primary" title="" checked="">
                            </div>
                        </div>
                        <ul class="chartsContent">
                            <li class="eui-form-item">
                                <label class="eui-col-md10 eui-paddingT10 eui-textAlignL">男</label>
                                <div class="eui-col-md2 eui-textAlignR eui-paddingR10">
                                    <input type="checkbox" name="sex" e-skin="primary" class="sex" value="1" checked=""
                                           e-filter="allChoose">
                                </div>
                            </li>
                            <li class="eui-form-item">
                                <label class="eui-col-md10 eui-paddingT10 eui-textAlignL">女</label>
                                <div class="eui-col-md2 eui-textAlignR eui-paddingR10">
                                    <input type="checkbox" name="sex" e-skin="primary" class="sex" value="0" checked=""
                                           e-filter="allChoose">
                                </div>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <div class="eui-form-item chartsTitle">
                            <label class="eui-form-label eui-textAlignL">年龄</label>
                            <div class="eui-input-block eui-textAlignR eui-paddingR10">
                                <input type="checkbox" name="like[write]" e-skin="primary" title="" checked="">
                            </div>
                        </div>
                        <ul class="chartsContent">
                            <li class="eui-form-item">
                                <label class="eui-col-md10 eui-paddingT10 eui-textAlignL">18岁以下</label>
                                <div class="eui-col-md2 eui-textAlignR eui-paddingR10">
                                    <input type="checkbox" name="age" value="0" e-skin="primary" title=""
                                           e-filter="allChoose" checked="">
                                </div>
                            </li>
                            <li class="eui-form-item">
                                <label class="eui-col-md10 eui-paddingT10 eui-textAlignL">19-44岁</label>
                                <div class="eui-col-md2 eui-textAlignR eui-paddingR10">
                                    <input type="checkbox" name="age" value="1" e-skin="primary" title=""
                                           e-filter="allChoose" checked="">
                                </div>
                            </li>
                            <li class="eui-form-item">
                                <label class="eui-col-md10 eui-paddingT10 eui-textAlignL">45-59</label>
                                <div class="eui-col-md2 eui-textAlignR eui-paddingR10">
                                    <input type="checkbox" name="age" value="2" e-skin="primary" title=""
                                           e-filter="allChoose" checked="">
                                </div>
                            </li>
                            <li class="eui-form-item">
                                <label class="eui-col-md10 eui-paddingT10 eui-textAlignL">60-74</label>
                                <div class="eui-col-md2 eui-textAlignR eui-paddingR10">
                                    <input type="checkbox" name="age" value="3" e-skin="primary" title=""
                                           e-filter="allChoose" checked="">
                                </div>
                            </li>
                            <li class="eui-form-item">
                                <label class="eui-col-md10 eui-paddingT10 eui-textAlignL">75-89岁</label>
                                <div class="eui-col-md2 eui-textAlignR eui-paddingR10">
                                    <input type="checkbox" name="age" value="4" e-skin="primary" title=""
                                           e-filter="allChoose" checked="">
                                </div>
                            </li>
                            <li class="eui-form-item">
                                <label class="eui-col-md10 eui-paddingT10 eui-textAlignL">90岁以上</label>
                                <div class="eui-col-md2 eui-textAlignR eui-paddingR10">
                                    <input type="checkbox" name="age" value="5" e-skin="primary" title=""
                                           e-filter="allChoose" checked="">
                                </div>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <div class="eui-form-item chartsTitle">
                            <label class="eui-form-label eui-textAlignL">宗教</label>
                            <div class="eui-input-block eui-textAlignR eui-paddingR10">
                                <input type="checkbox" e-skin="primary" title="" checked="" e-filter="allChoose">
                            </div>
                        </div>
                        <ul class="chartsContent">
                            <li class="eui-form-item">
                                <label class="eui-col-md10 eui-paddingT10 eui-textAlignL">没有</label>
                                <div class="eui-col-md2 eui-textAlignR eui-paddingR10">
                                    <input type="checkbox" name="belief" e-skin="primary" value="0" checked=""
                                           e-filter="allChoose">
                                </div>
                            </li>
                            <li class="eui-form-item">
                                <label class="eui-col-md10 eui-paddingT10 eui-textAlignL">基督教</label>
                                <div class="eui-col-md2 eui-textAlignR eui-paddingR10">
                                    <input type="checkbox" name="belief" e-skin="primary" value="1" checked=""
                                           e-filter="allChoose">
                                </div>
                            </li>
                            <li class="eui-form-item">
                                <label class="eui-col-md10 eui-paddingT10 eui-textAlignL">佛教</label>
                                <div class="eui-col-md2 eui-textAlignR eui-paddingR10">
                                    <input type="checkbox" name="belief" e-skin="primary" value="2" checked=""
                                           e-filter="allChoose">
                                </div>
                            </li>
                            <li class="eui-form-item">
                                <label class="eui-col-md10 eui-paddingT10 eui-textAlignL">道教</label>
                                <div class="eui-col-md2 eui-textAlignR eui-paddingR10">
                                    <input type="checkbox" name="belief" e-skin="primary" value="3" checked=""
                                           e-filter="allChoose">
                                </div>
                            </li>
                            <li class="eui-form-item">
                                <label class="eui-col-md10 eui-paddingT10 eui-textAlignL">天主教</label>
                                <div class="eui-col-md2 eui-textAlignR eui-paddingR10">
                                    <input type="checkbox" name="belief" e-skin="primary" value="4" checked=""
                                           e-filter="allChoose">
                                </div>
                            </li>
                            <li class="eui-form-item">
                                <label class="eui-col-md10 eui-paddingT10 eui-textAlignL">伊斯兰教</label>
                                <div class="eui-col-md2 eui-textAlignR eui-paddingR10">
                                    <input type="checkbox" name="belief" e-skin="primary" value="5" checked=""
                                           e-filter="allChoose">
                                </div>
                            </li>
                            <li class="eui-form-item">
                                <label class="eui-col-md10 eui-paddingT10 eui-textAlignL">其他</label>
                                <div class="eui-col-md2 eui-textAlignR eui-paddingR10">
                                    <input type="checkbox" name="belief" e-skin="primary" value="6" checked=""
                                           e-filter="allChoose">
                                </div>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <div class="eui-form-item chartsTitle">
                            <label class="eui-form-label eui-textAlignL">婚姻</label>
                            <div class="eui-input-block eui-textAlignR eui-paddingR10">
                                <input type="checkbox" e-skin="primary" title="" checked="">
                            </div>
                        </div>
                        <ul class="chartsContent">
                            <li class="eui-form-item">
                                <label class="eui-col-md10 eui-paddingT10 eui-textAlignL">未婚</label>
                                <div class="eui-col-md2 eui-textAlignR eui-paddingR10">
                                    <input type="checkbox" name="maritalStatus" e-skin="primary" value="1" checked=""
                                           e-filter="allChoose">
                                </div>
                            </li>
                            <li class="eui-form-item">
                                <label class="eui-col-md10 eui-paddingT10 eui-textAlignL">已婚</label>
                                <div class="eui-col-md2 eui-textAlignR eui-paddingR10">
                                    <input type="checkbox" name="maritalStatus" e-skin="primary" value="2" checked=""
                                           e-filter="allChoose">
                                </div>
                            </li>
                            <li class="eui-form-item">
                                <label class="eui-col-md10 eui-paddingT10 eui-textAlignL">已婚分居</label>
                                <div class="eui-col-md2 eui-textAlignR eui-paddingR10">
                                    <input type="checkbox" name="maritalStatus" e-skin="primary" value="3" checked=""
                                           e-filter="allChoose">
                                </div>
                            </li>
                            <li class="eui-form-item">
                                <label class="eui-col-md10 eui-paddingT10 eui-textAlignL">再婚</label>
                                <div class="eui-col-md2 eui-textAlignR eui-paddingR10">
                                    <input type="checkbox" name="maritalStatus" e-skin="primary" value="4" checked=""
                                           e-filter="allChoose">
                                </div>
                            </li>
                            <li class="eui-form-item">
                                <label class="eui-col-md10 eui-paddingT10 eui-textAlignL">离婚独居</label>
                                <div class="eui-col-md2 eui-textAlignR eui-paddingR10">
                                    <input type="checkbox" name="maritalStatus" e-skin="primary" value="5" checked=""
                                           e-filter="allChoose">
                                </div>
                            </li>
                            <li class="eui-form-item">
                                <label class="eui-col-md10 eui-paddingT10 eui-textAlignL">丧偶独居</label>
                                <div class="eui-col-md2 eui-textAlignR eui-paddingR10">
                                    <input type="checkbox" name="maritalStatus" e-skin="primary" value="6" checked=""
                                           e-filter="allChoose">
                                </div>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
        <div class="eui-mn1">
            <div class="eui-mn1-type3">
                <div class="eui-row eui-form">
                    <label class="eui-col-md1 eui-form-label">时间：</label>
                    <div class="eui-col-md3">
                        <select name="city" e-verify="required" e-filter="selected">
                            <option value="0" selected="">近7天</option>
                            <option value="1">近30天</option>
                            <option value="2">选择时间</option>
                        </select>
                    </div>
                    <div class="eui-col-md3 eui-marginL10"><span class="eui-btn eui-btn-normal">当前数据导出</span></div>
                </div>
                <div class="eui-row eui-marginT20">
                    <div class="eui-col-md1 eui-font18">区域分布</div>
                    <div class="eui-col-md4 eui-color-gray3 eui-marginT5">2017-11-01 至 2017-11-07</div>
                    <div class="eui-col-md7 eui-textAlignR"><img src="/Styles/images/xymfImages/xymf/export.png"
                                                                 alt=""/> 导出
                    </div>
                    <div class="areal eui-col-md12 eui-padding5 eui-marginT10">
                        <div class="arealIn"></div>
                        <div class="eui-row eui-padding5">
                            <div class="eui-col-md7">
                                <div id="map" class="charts0" style="height: 360px;"></div>
                            </div>
                            <div class="eui-col-md5">
                                <div class="eui-tab eui-tab-brief" e-filter="docDemoTabBrief">
                                    <ul class="eui-tab-title">
                                        <li class="eui-this">省份</li>
                                        <li>城市</li>
                                    </ul>
                                    <div class="eui-tab-content">
                                        <div class="eui-tab-item eui-show">
                                            <ul class="statistics province">
                                            </ul>
                                        </div>
                                        <div class="eui-tab-item">
                                            <ul class="statistics city">

                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="eui-row eui-marginT20">
                    <div class="eui-col-md1 eui-font18">问卷类型</div>
                    <div class="eui-col-md4 eui-color-gray3 eui-marginT5">2017-11-01 至 2017-11-07</div>
                    <div class="eui-col-md7 eui-textAlignR"><img src="/Styles/images/xymfImages/xymf/export.png"
                                                                 alt=""/> 导出
                    </div>
                    <div class="areal eui-col-md12 eui-padding5 eui-marginT10 eui-marginB10">
                        <div class="arealIn"></div>
                        <div class="eui-padding5 types">
                            <table class="eui-table" e-skin="line">
                                <colgroup>
                                    <col width="18">
                                    <col width="150">
                                    <col width="260">
                                    <col width="80">
                                    <col width="80">
                                </colgroup>
                                <thead>
                                <tr>
                                    <th>排名</th>
                                    <th>问卷类型名称</th>
                                    <th>使用数量/占比</th>
                                    <th>同比</th>
                                    <th>环比</th>
                                </tr>
                                </thead>
                                <tbody>
                                <!--<tr>
                                    <td>1</td>
                                    <td>人格评估</td>
                                    <td class="eui-row">
                                        <span class="eui-col-md2">18999</span>
                                        <div class="eui-progress eui-progress-big eui-col-md10" e-showpercent="yes">
                                            <div class="eui-progress-bar" e-percent="50%"></div>
                                        </div>
                                    </td>
                                    <td>12% <img src="/Styles/images/xymfImages/xymf/up.png" alt=""/></td>
                                    <td>2% <img src="/Styles/images/xymfImages/xymf/down.png" alt=""/></td>
                                </tr>-->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="eui-row eui-marginT20">
                    <div class="eui-col-md1 eui-font18">人群属性</div>
                    <div class="eui-col-md4 eui-color-gray3 eui-marginT5">2017-11-01 至 2017-11-07</div>
                    <div class="eui-col-md7 eui-textAlignR"><img src="/Styles/images/xymfImages/xymf/export.png"
                                                                 alt=""/> 导出
                    </div>
                    <div class="areal eui-col-md12 eui-padding20 eui-marginT10 eui-marginB10">
                        <div class="eui-row eui-col-space30">
                            <div class="eui-col-md6">
                                <div class="eui-font16 eui-marginB20 eui-marginT10">性别分布</div>
                                <div class="eui-row eui-marginB20">
                                    <div class="eui-col-md2 eui-paddingL10"><img
                                            src="/Styles/images/xymfImages/xymf/man.png" alt=""/></div>
                                    <div class="eui-col-md4">
                                        <p class="eui-font22 chartsColor1 man">23144人</p>
                                        <p class="eui-font22 chartsColor1 manPercent">58%</p>
                                    </div>
                                    <div class="eui-col-md4 eui-textAlignR">
                                        <p class="eui-font22 chartsColor2 women">20013人</p>
                                        <p class="eui-font22 chartsColor2 womenPercent">42%</p>
                                    </div>
                                    <div class="eui-col-md2 eui-textAlignR eui-paddingR10"><img
                                            src="/Styles/images/xymfImages/xymf/woman.png" alt=""/></div>
                                </div>
                                <div id="sex">

                                </div>
                            </div>
                            <div class="eui-col-md6">
                                <div class="eui-col-md6 eui-font16 eui-marginB20 eui-marginT10">年龄分布</div>
                                <div class="eui-col-md12">
                                    <div id="chart1" class="charts0"></div>
                                </div>
                            </div>
                        </div>
                        <div class="eui-row eui-col-space30">
                            <div class="eui-col-md6">
                                <div class="eui-font16 eui-marginB20 eui-marginT10">学历分布</div>
                                <div class="eui-col-md12">
                                    <div id="chart2" class="charts0"></div>
                                </div>
                            </div>
                            <div class="eui-col-md6">
                                <div class="eui-font16 eui-marginB20 eui-marginT10">婚姻状况</div>
                                <!--<div class="marriage">
                                    <div class="marriageIn marriage1">
                                        <p><span>1210</span>,<span>30%</span></p>
                                        <p>丧偶独居</p>
                                    </div>
                                    <div class="marriageIn marriage2">
                                        <p><span>1210</span>,<span>30%</span></p>
                                        <p>已婚分居</p>
                                    </div>
                                    <div class="marriageIn marriage3">
                                        <p><span>1210</span>,<span>30%</span></p>
                                        <p>再婚</p>
                                    </div>
                                    <div class="marriageIn marriage4">
                                        <p><span>1210</span>,<span>30%</span></p>
                                        <p>已婚</p>
                                    </div>
                                    <div class="marriageIn marriage5">
                                        <p><span>1210</span>,<span>30%</span></p>
                                        <p>丧偶独居</p>
                                    </div>
                                    <div class="marriageIn marriage6">
                                        <p><span>1210</span>,<span>30%</span></p>
                                        <p>离婚独居</p>
                                    </div>
                                </div>-->
                                <div id="marriages" class="charts0"></div>
                            </div>
                            <div class="eui-col-md12">
                                <div class="eui-font16 eui-marginB20 eui-marginT10">宗教信仰</div>
                                <div class="eui-col-md12">
                                    <div id="chart4" class="charts0"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div th:replace="project/cube/common/footer :: footer">footer</div>
</div>
</body>
<script src="/Scripts/module/eui.js"></script>
<script type="text/javascript" src="/Scripts/jquery-1.9.0.min.js"></script>
<!-- 引入 ECharts 文件 -->
<script src="/Scripts/plugins/echarts/echarts.min.js"></script>
<!-- 引入 macarons 主题 -->
<!--<script src="/Scripts/plugins/echarts/macarons.js"></script>-->
<!--婚姻状况脚本-->
<script src="https://d3js.org/d3.v4.min.js"></script>
<!--地图脚本-->
<script src="http://gallery.echartsjs.com/dep/echarts/map/js/china.js"></script>
<script src="/pack.ajax.js"></script>
<script src="/card.js"></script>

<script>
    var typeSum = 0;//计算初始化的次数
    var nowDate = new Date();
    nowDate.setDate(nowDate.getDate() - 7);
    var form, layer, element;
    eui.use(['form', 'layer', 'element'], function () {
        form = eui.form;
        layer = eui.layer;
        element = eui.element;
        form.on('select(selected)', function (data) {
            if (data.value == 0) {
                nowDate = new Date()
                nowDate.setDate(nowDate.getDate() - 7);
            } else if (data.value = 1) {
                nowDate = new Date()
                nowDate.setMonth(nowDate.getMonth() - 1);
            }
            doSearch();
        })
        form.on('checkbox(allChoose)', function (data) {
            doSearch();
        })
    })

    $(function () {
        doSearch();
    })
    var statusIds = '';
    var beliefIds = '';
    var sex = 0;
    var typeIds = '';
    function doSearch() {
        eui.use(['element'], function () {
            var element = eui.element;
            $('tbody').html("");
            $('.man').text(0);
            $('.manPercent').text('0%');
            $('.women').text(0);
            $('.womenPercent').text('0%');
            /*eui.use(['element'], function () {
             var element = eui.element;*/
            var sexArray = new Array();
            var s = 0;
            $(".sex:checked").each(function (i) {
                var id = $(this).parent().find("input[name='sex']").val();
                sexArray[s] = id;
                sex = id;
                s++;
            });

            var beliefArray = new Array();
            $('input[name="belief"]:checked').each(function (i) {
                var belief = $(this).parent().find("input[name='belief']").val();
                beliefArray[i] = belief;
            })
            beliefIds = beliefArray.join(",");

            var statusArray = new Array();
            $('input[name="maritalStatus"]:checked').each(function (i) {
                var maritalStatus = $(this).parent().find("input[name='maritalStatus']").val();
                statusArray[i] = maritalStatus;
            })
            statusIds = statusArray.join(",");

            var typeArray = new Array();
            $('input[name="type"]:checked').each(function (i) {
                var maritalStatus = $(this).parent().find("input[name='type']").val();
                typeArray[i] = maritalStatus;
            })

            typeIds = typeArray.join(",");

            if (sexArray.length == 2) {
                sex = '';
            }
            if (sexArray.length == 0) {
                sex = 3;
            } else if (statusArray.length == 0) {
                return;
            } else if (beliefArray.length == 0) {
                return;
            }
            $.post("/visitor/register/getCount", {
                startTime: nowDate,
                endTime: new Date(),
                sex: sex,
                maritalStatus: statusIds,
                belief: beliefIds,
                questionName: typeIds,
                name: '',
                province: '',
                city: ''
            }, function (result) {
                /*console.log(result);*/
                if (result.code = 200) {
                    var manSum = 0;
                    var womenSum = 0;
                    var resuliList = result.data
                    var registerList = countAge(resuliList);
                    var value = [0, 0, 0, 0, 0, 0, 0];
                    var data = [0, 0, 0, 0, 0, 0, 0];
                    var statusData = [
                        {"name": "未婚", "size": 0, "add": "11", "rate": "13%"},
                        {"name": "已婚", "size": 0, "add": "11", "rate": "13%"},
                        {"name": "已婚分居", "size": 0, "add": "11", "rate": "13%"},
                        {"name": "再婚", "size": 0, "add": "11", "rate": "13%"},
                        {"name": "离婚独居", "size": 0, "add": "11", "rate": "13%"},
                        {"name": "丧偶独居", "size": 0, "add": "11", "rate": "13%"},
                    ]
                    for (var i in registerList) {
                        var register = registerList[i];
                        if (register.sex == 1) {
                            manSum++;
                        } else {
                            womenSum++;
                        }

                        //学历分布
                        var level = register.educationLevel;
                        if (level == 1) {
                            value[0]++;
                        } else if (level == 2) {
                            value[1]++;
                        } else if (level == 3) {
                            value[2]++;
                        } else if (level == 4) {
                            value[3]++;
                        } else if (level == 5) {
                            value[4]++;
                        } else if (level == 6) {
                            value[5]++;
                        } else {
                            value[6]++;
                        }
                        //宗教信仰分布
                        var belief = register.religiousBelief;
                        if (belief == 0) {
                            data[0]++;
                        } else if (belief == 1) {
                            data[1]++;
                        } else if (belief == 2) {
                            data[2]++;
                        } else if (belief == 3) {
                            data[3]++;
                        } else if (belief == 4) {
                            data[4]++;
                        } else if (belief == 5) {
                            data[5]++;
                        } else {
                            data[6]++;
                        }

                        //婚姻状况分布
                        var status = register.maritalStatus;
                        if (status == 1) {
                            statusData[0].size++;
                        } else if (status == 2) {
                            statusData[1].size++;
                        } else if (status == 3) {
                            statusData[2].size++;
                        } else if (status == 4) {
                            statusData[3].size++;
                        } else if (status == 5) {
                            statusData[4].size++;
                        } else if (status == 6) {
                            statusData[5].size++;
                        }
                    }
                    var manPercent = '';
                    var womenPercent = '';
                    if (registerList.length != 0) {
                        manPercent = ((manSum / registerList.length) * 100).toFixed(1) + "%";
                        womenPercent = ((womenSum / registerList.length) * 100).toFixed(1) + "%";
                    } else {
                        manPercent = '0%'
                        womenPercent = '0%'
                    }

                    init(value);//学历分布
                    religiousBelief(data);//宗教信仰分布
                    var marryData = [];
                    for (var i in statusData) {
                        if (statusData[i].size != 0) {
                            marryData.push(statusData[i]);
                        }
                    }
                    ageList(registerList);//计算年龄分布
                    marry(marryData);//初始化婚姻状况
                    $('.man').text(manSum);
                    $('.manPercent').text(manPercent);
                    $('.women').text(womenSum);
                    $('.womenPercent').text(womenPercent);
                    var i = 0
                    $('#sex').html("");
                    for (i; i <= 6; i++) {
                        var html = '';
                        html = '<ul class="sexSpread">';
                        var percent = ((manSum / registerList.length) * 100).toFixed(1)
                        var length = parseInt(percent / 5);
//                        console.log(length+","+percent);
                        if (percent > 0 && percent <= 5) {
                            length = 1;
                        }
                        for (var j = 0; j < length; j++) {
                            html += '<li></li>';
                        }
                        for (var k = 0; k < (20 - parseInt(length)); k++) {
                            html += '<li class="sexWoman"></li>';
                        }
                        html += '</ul>';
                        $('#sex').append(html);
                    }
                }else{
                    layer.msg("请重新加载",{
                        icon: 1,
                        time: 1500
                    })
                }
            })
            $.post("/visitor/register/getQuestionCount", {
                startTime: nowDate,
                endTime: new Date(),
                sex: sex,
                maritalStatus: statusIds,
                belief: beliefIds,
                questionName: typeIds,
                name: 'name',
                province: '',
                city: ''
            }, function (result) {
                if (result.code == 200) {
                    var thisYearList = countAge(result.data.thisYearList);
                    var lastYearList = countAge(result.data.lastYearList);
                    var lastPhaseList = countAge(result.data.lastPhaseList);
                    var countSum = getCountSum(thisYearList);//问卷总数
                    var lastCountSum = getCountSum(lastYearList);//去年的问卷总数
                    var lastPhaseSum = getCountSum(lastPhaseList);//上个时期的使用问卷总数
                    //同比增长率
                    var tongbi = (countSum - lastCountSum) / lastCountSum * 100 + '%';
                    var mom = (countSum - lastPhaseSum) / lastPhaseSum * 100 + '%';
                    if (lastPhaseSum == 0) {//如果上期的基数为0
                        mom = "--"
                    }
                    if (lastCountSum == 0) {//如果去年同期的基数为0
                        tongbi = "--"
                    }
                    var up = 'up';
                    var down = 'up';
                    if (!judgeSign(countSum - lastCountSum)) {//如果为负数，则为下降率
                        up = 'down';
                    }
                    if (!judgeSign(countSum - lastPhaseSum)) {//如果为负数，则为下降率
                        down = 'down';
                    }
                    typeSum++;//表示刷新数据次数+1
                    initType(thisYearList);//设置问卷类型名称复选框
                    for (var j in thisYearList) {
                        var thisYear = thisYearList[j].questionnaire;
                        var progressBar = (thisYear.count / countSum) * 100;
                        progressBar = parseInt(progressBar) + '%';
                        var tableHtml = '';
                        tableHtml = '<tr>' +
                                '<td>' + (parseInt(j) + 1) + '</td>' +
                                '<td>' + thisYear.questionnaireName + '</td>' +
                                '<td class="eui-row">' +
                                '<span class="eui-col-md2">' + thisYear.count + '</span>' +
                                '<div class="eui-progress eui-col-md10 eui-marginT10" e-showpercent="yes" e-filter="question' + j + '">' +
                                '<div class="eui-progress-bar"></div>' +
                                '</div>' +
                                '</td>' +
                                '<td>' + tongbi + '<img src="/Styles/images/xymfImages/xymf/' + up + '.png" alt=""/></td>' +
                                '<td>' + mom + '<img src="/Styles/images/xymfImages/xymf/' + down + '.png" alt=""/></td>' +
                                '</tr>';
                        $('tbody').append(tableHtml);
                        var name = 'question' + j.toString();
                        element.progress(name, progressBar);
                        element.init('progress', name);
                    }
                }
            })
        })
        getProvince();
        getCity();
    }

    //计算年龄段后得出的数据
    function countAge(resuliList) {
        var registerList =[];
        $('input[name="age"]:checked').each(function (i) {
            var ageValue = $(this).parent().find("input[name='age']").val();
            for (var i in resuliList) {
                var res = resuliList[i];
                var age = new Date().getYear() - new Date(res.birthday).getYear();
                if (ageValue == 0) {
                    if (age <= 18) {
                        registerList.push(res);
                    }
                }else if(ageValue == 1){
                    if (age >= 19 && age <=44) {
                        registerList.push(res);
                    }
                }else if(ageValue == 2){
                    if (age >= 45 && age <=59) {
                        registerList.push(res);
                    }
                }else if(ageValue == 3){
                    if (age >= 60 && age <=74) {
                        registerList.push(res);
                    }
                }else if(ageValue == 4){
                    if (age >= 75 && age <=89) {
                        registerList.push(res);
                    }
                }else if(ageValue == 5){
                    if (age >= 90) {
                        registerList.push(res);
                    }
                }
            }
        })
        return registerList;
    }


    //设置问卷类型名称复选框
    var list;
    function initType(thisYearList) {
        if (typeSum == 1) {
            list = thisYearList
        } else {
            return;
        }
        var html = '';
        for (var j in list) {
            var thisYear = list[j].questionnaire;
            html += '<li class="eui-form-item">' +
                    '<label class="eui-col-md10 eui-paddingT10 eui-textAlignL">' + thisYear.questionnaireName + '</label>' +
                    '<div class="eui-col-md2 eui-textAlignR eui-paddingR10">' +
                    '<input type="checkbox" name="type" e-skin="primary" value="'+thisYear.questionnaireName+'" title="" e-filter="allChoose" checked>' +
                    '</div>' +
                    '</li>';
        }
        $('#type').html(html);
    }
    //校验数字是正数还是负数
    function judgeSign(num) {
        var absVal = Math.abs(num);
        return num == absVal ? true : false;
    }

    /**
     * 计算总数
     */
    function getCountSum(list) {
        var result = 0;
        for (var i in list) {
            var obj = list[i].questionnaire;
            result += obj.count;
        }
        return result;
    }
    var ageNameData = ["<18", "≥19", "≥45", "≥60", "≥75", "≥90"]
    function ageList(registerList) {
        var ageData = [0, 0, 0, 0, 0, 0];
        for (var i in registerList) {
            var register = registerList[i];
            var age = new Date().getYear() - new Date(register.birthday).getYear();
            /*console.log("年龄是:"+age);*/
            if (age < 18) {
                ageData[0]++;
            } else if (age >= 19 && age <= 44) {
                ageData[1]++;
            } else if (age >= 45 && age <= 59) {
                ageData[2]++;
            } else if (age >= 60 && age <= 74) {
                ageData[3]++;
            } else if (age >= 75 && age <= 89) {
                ageData[4]++;
            } else {
                ageData[5]++;
            }
        }
        ageInit(ageNameData, ageData);
    }
    /**
     * 获取省份排名
     */
    function getProvince() {
        eui.use('form', function () {
            var form = eui.form;
            $.post("/visitor/register/getQuestionCount", {
                startTime: nowDate,
                endTime: new Date(),
                sex: sex,
                maritalStatus: statusIds,
                belief: beliefIds,
                questionName: typeIds,
                name: '',
                province: 'province',
                city: ''
            }, function (result) {
                var provinceData = [{
                    name: '北京',
                    value: 0
                }, {
                    name: '天津',
                    value: 0
                }, {
                    name: '上海',
                    value: 0
                }, {
                    name: '重庆',
                    value: 0
                }, {
                    name: '河北',
                    value: 0
                }, {
                    name: '河南',
                    value: 0
                }, {
                    name: '云南',
                    value: 0
                }, {
                    name: '辽宁',
                    value: 0
                }, {
                    name: '黑龙江',
                    value: 0
                }, {
                    name: '湖南',
                    value: 0
                }, {
                    name: '安徽',
                    value: 0
                }, {
                    name: '山东',
                    value: 0
                }, {
                    name: '新疆',
                    value: 0
                }, {
                    name: '江苏',
                    value: 0
                }, {
                    name: '浙江',
                    value: 0
                }, {
                    name: '江西',
                    value: 0
                }, {
                    name: '湖北',
                    value: 0
                }, {
                    name: '广西',
                    value: 0
                }, {
                    name: '甘肃',
                    value: 0
                }, {
                    name: '山西',
                    value: 0
                }, {
                    name: '内蒙古',
                    value: 0
                }, {
                    name: '陕西',
                    value: 0
                }, {
                    name: '吉林',
                    value: 0
                }, {
                    name: '福建',
                    value: 0
                }, {
                    name: '贵州',
                    value: 0
                }, {
                    name: '广东',
                    value: 0
                }, {
                    name: '青海',
                    value: 0
                }, {
                    name: '西藏',
                    value: 0
                }, {
                    name: '四川',
                    value: 0
                }, {
                    name: '宁夏',
                    value: 0
                }, {
                    name: '海南',
                    value: 0
                }, {
                    name: '台湾',
                    value: 0
                }, {
                    name: '香港',
                    value: 0
                }, {
                    name: '澳门',
                    value: 0
                }, {
                    name: '南海诸岛',
                    value: 0
                }]
                if (result.code == 200) {
                    var thisYearList = countAge(result.data.thisYearList);
                    var tableHtml = '';
                    for (var i in thisYearList) {
                        var list = thisYearList[i];
                        var thisYear = thisYearList[i].questionnaire;
                        var count = getCountSum(thisYearList);
                        var progressBar = (thisYear.count / count) * 100;
                        progressBar = parseInt(progressBar) + "%";
                        tableHtml += '<li class="eui-marginB10">' +
                                '<div class="eui-col-md3 eui-textAlignR eui-paddingR10">' + (parseInt(i) + 1) + '、' + list.province + '</div>' +
                                '<div class="eui-col-md9 eui-paddingT5">' +
                                '<div class="eui-progress" e-filter="que' + i + '">' +
                                '<div class="eui-progress-bar" ></div>' +
                                '</div>' +
                                '</div>' +
                                '</li>';

                        for (var j in provinceData) {
                            var province = provinceData[j];
                            if (list.province.indexOf(province.name) != -1) {
                                province.value = thisYear.count;
                            }
                        }
                    }
                    $('.province').html(tableHtml);
                    var count = getCountSum(thisYearList);
                    form.render();
                    for (var j in thisYearList) {
                        eui.use(['element'], function () {
                            var element = eui.element;
                            var thisYear = thisYearList[j].questionnaire;
                            var progressBar = (thisYear.count / count) * 100;
                            progressBar = parseInt(progressBar) + "%";
                            /*console.log(progressBar)*/
                            var name = 'que' + '' + j;
                            element.progress(name, progressBar);
                        })
                    }
                }
                initProvince(provinceData);
            })
        })
    }


    function getCity() {
        eui.use('form', function () {
            var form = eui.form;
            $.post("/visitor/register/getQuestionCount", {
                startTime: nowDate,
                endTime: new Date(),
                sex: sex,
                maritalStatus: statusIds,
                belief: beliefIds,
                questionName: typeIds,
                name: '',
                province: '',
                city: 'city'
            }, function (result) {
                /*console.log(result);*/
                if (result.code == 200) {
                    var thisYearList =countAge(result.data.thisYearList);
                    var tableHtml='';
                    for (var i in thisYearList) {
                        var list = thisYearList[i];
                        tableHtml += '<li class="eui-marginB10">' +
                                '<div class="eui-col-md5 eui-textAlignL eui-paddingR10">' + (parseInt(i) + 1) + '、' + list.city + '</div>' +
                                '<div class="eui-col-md7 eui-paddingT5">' +
                                '<div class="eui-progress" e-filter="ques' + i + '">' +
                                '<div class="eui-progress-bar"></div>' +
                                '</div>' +
                                '</div>' +
                                '</li>';
                    }
                    $('.city').html(tableHtml);
                    var count = getCountSum(thisYearList);
                    for (var j in thisYearList) {
                        eui.use(['element'], function () {
                            var element = eui.element;
                            var thisYear = thisYearList[j].questionnaire;
                            var progressBar = (thisYear.count / count) * 100;
                            progressBar = parseInt(progressBar) + "%";
                            /*console.log(progressBar)*/
                            var name = 'ques' + '' + j;
                            element.progress(name, progressBar);
                        })
                    }
                    form.render();
                }
            })
        })
    }

    // charts用户统计页面左侧筛选栏
    $(".filter>li .chartsContent").hide();
    $(".filter>li").click(function () {
        $(this).siblings().children(".chartsContent").hide();
        $(this).children(".chartsContent").stop().slideToggle();
        $(this).children(".chartsTitle").addClass("chartsTitle0").siblings(".filter>li").children(".chartsTitle").removeClass("chartsTitle0");
        $(".filter>li .eui-form-checkbox").click(function () {
            event.stopPropagation();
        });
    });
    // 收藏模版
    $(".collect").click(function () {
        $(this).toggleClass("collectIn");
    })
    // 左侧宽度
    var carouselHeight = $(window).height() - 270;
    $(".filter").css("height", carouselHeight + 'px');

    // 年龄分布
    function ageInit(ageNameDate, ageData) {
        var myChart = echarts.init(document.getElementById('chart1'), 'macarons');
        var option = {
            tooltip: {},
            legend: {
                data: ['年龄']
            },
            //修改柱状条的颜色color
            itemStyle: {
                normal: {
                    //柱形图圆角，初始化效果
                    barBorderRadius: [300, 300, 0, 0],
                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                        offset: 0,
                        color: '#ffe575'
                    }, {
                        offset: 1,
                        color: '#ffcf00'

                    }]),
                    shadowBlur: 200,
                    shadowColor: 'rgba(0, 0, 0, 0.1)'
                }
            },
            xAxis: {
                type: 'category',
                axisLine: {
                    show: false, // 是否显示坐标轴轴线。
                    lineStyle: {
                        color: '#666666'
                    }
                },

                axisTick: {
                    show: false // 是否显示坐标轴刻度。
                },
                axisLabel: {
                    color: '#333333' // 标签文字颜色
                },
                // boundaryGap: false,
                data: ageNameDate
            },

            yAxis: {
                position: 'right',
                type: 'value',
                axisLine: {
                    show: false, // 是否显示坐标轴轴线。
                    lineStyle: {
                        color: '#999999'
                    }
                },
                axisTick: {
                    show: false // 是否显示坐标轴刻度。
                },
                axisLabel: {
                    formatter: '{value} %',
                    color: '#999999' // 标签文字颜色
                },
                splitLine: {
                    lineStyle: {
                        // 分割线颜色 使用深浅的间隔色
                        color: ['#eeeeee']
                    }
                },
                // 坐标轴分隔区域的显示间隔
                splitArea: {
                    areaStyle: {
                        color: 'transparent'
                    }
                }
            },
            series: [{
                //name: '销量',
                type: 'bar',
                barWidth: 24,//柱图宽度
                data: ageData
            }]
        };
        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
        //年龄分布
    }

    function init(value) {
        // 雷达图
        var myChart = echarts.init(document.getElementById('chart2'), 'macarons');
        // 指定图表的配置项和数据
        var option = {
            title: {
                // text: '年龄分布',
                textStyle: {
                    color: '#333'
                }
            },
            radar: {
                name: {
                    textStyle: {
                        color: '#333', // 字体颜色
                        borderRadius: 3,
                        padding: [3, 5]
                    }
                },
                indicator: [
                    {name: '小学', max: Math.max.apply(null, value)},
                    {name: '初中', max: Math.max.apply(null, value)},
                    {name: '高中', max: Math.max.apply(null, value)},
                    {name: '专科', max: Math.max.apply(null, value)},
                    {name: '本科', max: Math.max.apply(null, value)},
                    {name: '研究生', max: Math.max.apply(null, value)},
                    {name: '博士', max: Math.max.apply(null, value)}
                ],
                splitArea: {
                    areaStyle: {
                        // 圆背景颜色 rgba(0,73,134,0.8)
                        // color: ['transparent'],
                        shadowColor: 'transparent',
                        shadowBlur: 10
                    }
                }
            },
            series: [{
                // name: '年龄分布',
                areaStyle: {
                    normal: {
                        opacity: 0.6,
                        color: new echarts.graphic.RadialGradient(0.7, 0.5, 1, [
                            {
                                color: '#1e87d6',
                                offset: 0
                            },
                            {
                                color: '#02f4cb',
                                offset: 1
                            }
                        ])
                    }
                },
                itemStyle: {
                    normal: {
                        color: "#61a0a8", // 图表中各个图区域的边框线拐点颜色
                        lineStyle: {
                            color: "rgba(255,255,255,0.4)" // 图表中各个图区域的边框线颜色
                        },
                        areaStyle: {
                            type: 'default'
                        }
                    }
                },
                label: {
                    normal: {
                        show: true

                    }
                },
                type: 'radar',
                data: [
                    {
                        value: value,
                        name: '学历分布'
                    }
                ]
            }]
        };
        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
        // 雷达图结束
    }

    function religiousBelief(data) {
        /* 宗教信仰 */
        var myChart = echarts.init(document.getElementById('chart4'), 'macarons');
        var option = {
//    title: {
//      text: '入门示例'
//    },
            tooltip: {},
            legend: {
                data: ['销量']
            },
            xAxis: {
                data: ["没有", "基督教", "佛教", "道教", "天主教", "伊斯兰教", "其他"]
            },
//       修改柱状条的颜色color
            itemStyle: {
                normal: {
                    //柱形图圆角，初始化效果
                    barBorderRadius: [5, 5, 0, 0],
                    color: function (params) {
                        var colorList = ['#ffcf00', '#ff9a63', '#a4de6c', '#82ca9d', '#8dd1e1', '#9cacf1', '#8884d8'];
                        return colorList[params.dataIndex];
                    },
                    shadowBlur: 200,
                    shadowColor: 'rgba(0, 0, 0, 0.1)'
                }
            },
            xAxis: {
                type: 'category',
                axisLine: {
                    show: false, // 是否显示坐标轴轴线。
                    lineStyle: {
                        color: '#666666'
                    }
                },

                axisTick: {
                    show: false // 是否显示坐标轴刻度。
                },
                axisLabel: {
                    color: '#333333' // 标签文字颜色
                },
                // boundaryGap: false,
                data: ["没有", "基督教", "佛教", "道教", "天主教", "伊斯兰教", "其他"]
            },

            yAxis: {
                position: 'right',
                type: 'value',
                axisLine: {
                    show: false, // 是否显示坐标轴轴线。
                    lineStyle: {
                        color: '#999999'
                    }
                },
                axisTick: {
                    show: false // 是否显示坐标轴刻度。
                },
                axisLabel: {
                    formatter: '{value} %',
                    color: '#999999' // 标签文字颜色
                },
                splitLine: {
                    show: true,
                    lineStyle: {
                        // 分割线颜色 使用深浅的间隔色
                        color: ['#eeeeee']
                    }
                },
                // 坐标轴分隔区域的显示间隔
                splitArea: {
                    areaStyle: {
                        color: 'transparent'
                    }
                }
            },
            series: [{
//            name: '销量',
                type: 'bar',
                barWidth: 30,//柱图宽度
                data: data
            }]
        };
        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
    }
    // 婚姻状况
    function marry(data) {
        var myChart = echarts.init(document.getElementById('marriages'), 'macarons');
        //数据
        var data = {
            "children": data
        };

        //配色
        var getFillColor = function (nodeName, isLeaf) {
            var fill = {};
            var baseArray = ["未婚", "已婚", "已婚分居", "再婚", "离婚独居", "丧偶独居"];
            if ($.inArray(nodeName, baseArray) != -1) {
                if (isLeaf) {
                    fill.fillColor = {
                        type: "radial",
                        x: 0.7,
                        y: 0.7,
                        r: 0.7,
                        colorStops: [{
                            offset: 0,
                            color: "#9f9ce0" // 0% 处的颜色
                        }, {
                            offset: 1,
                            color: "#86a5ee" // 100% 处的颜色
                        }],
                        globalCoord: false // 缺省为 false
                    };
//                fill.borderColor = "#03a1b3";
                    fill.borderWidth = 1;
                    fill.emphasisFillColor = {
                        type: "radial",
                        x: 0.7,
                        y: 0.7,
                        r: 0.7,
                        colorStops: [{
                            offset: 0,
                            color: "#938edb" // 0% 处的颜色
                        }, {
                            offset: 1,
                            color: "#89a8ef" // 100% 处的颜色
                        }],
                        globalCoord: false // 缺省为 false
                    };
                    fill.emphasisBorderColor = "#89a8ef";
                    fill.emphasisborderWidth = 1;
                } else {
//                fill.fillColor = "rgba(0, 252, 255, 0.1)";
//                fill.borderColor = "rgba(11, 72, 115, 1)";
//                fill.borderWidth = 0;
//                fill.emphasisFillColor = "rgba(0, 252, 255, 0.1)";
//                fill.emphasisBorderColor = "rgba(11, 72, 115, 1)";
//                fill.emphasisborderWidth = 0;
                }
            }
            return fill;
        };

        //渲染函数
        var renderItem = function (params, api) {
            var fillObj = getFillColor(api.value(2), api.value(9));
            var textPosition = "inside";
            if (!api.value(9)) {
                if (api.value(1) == 1) {
                    if (api.value(6) > api.getWidth() / 2) {
                        textPosition = "right";
                    } else {
                        textPosition = "left";
                    }
                } else {
                    textPosition = "top";
                }
            }
            return {
                type: "circle",
                shape: {
                    cx: api.value(6),
                    cy: api.value(7),
                    r: api.value(8)
                },
                z2: api.value(1) * 2,
                style: api.style({
                    stroke: fillObj.borderColor,
                    fill: fillObj.fillColor,
                    textPosition: textPosition,
                    lineWidth: fillObj.borderWidth
                    //text: nodeName,
                    // textFont: textFont,
                    // textDistance : itemLayout.r,
                }),
                styleEmphasis: api.style({
                    textPosition: textPosition,
                    stroke: fillObj.emphasisBorderColor,
                    fill: fillObj.emphasisFillColor,
                    lineWidth: fillObj.emphasisborderWidth
                })
            };
        };

        var root = d3.hierarchy(data)
                .sum(function (d) {
                    return d.size;
                })
                .sort(function (a, b) {
                    return b.value - a.value;
                });
        d3.pack()
                .size([240, 260])
                .padding(0.5)(root);
        var maxDepth = 0;
        var nodeAll = root.descendants();
        var nodes = nodeAll.filter(function (it) {
            return it.parent;
        });

        //获取各圆相关数据
        var seriesData = nodes.map(function (node) {
            maxDepth = Math.max(maxDepth, node.depth);
            var color = "#ffffff";
            node.isLeaf = !node.children || !node.children.length;
            if (node.depth == 1) {
                switch (node.data.name) {
                    case "健康档案数量":
                        color = "rgba(14, 149, 156, 1)";
                        break;
                }
                return {
                    value: [
                        node.value,
                        node.depth,
                        node.data.name,
                        node.data.size,
                        node.data.add,
                        node.data.rate,
                        node.x,
                        node.y,
                        node.r,
                        node.isLeaf
                    ],
                    label: {
                        normal: {
                            show: true,
                            color: color,
                            formatter: function (params) {
                                return params.value[2] + "\n" + params.value[3]
                            },
                            rich: {
                                type: {
                                    fontSize: 14,
                                    color: color
                                },
                                numAll: {
                                    fontSize: 28,
                                    padding: [5, 0, 5, 0],
                                    color: color
                                },
                                add: {
                                    fontSize: 14,
                                    color: color
                                }
                            }
                        }
                    }
                }
            } else {
                if (node.data.name == "家庭医生签约" || node.data.name == "慢性病人管理数") {
                    color = "rgba(222, 0, 155,1)";
                }
                return {
                    value: [
                        node.value,
                        node.depth,
                        node.data.name,
                        node.data.size,
                        node.data.add,
                        node.data.rate,
                        node.x,
                        node.y,
                        node.r,
                        node.isLeaf
                    ],
                    label: {
                        normal: {
                            show: true,
                            color: color,
                            position: "inside",
                            formatter: function (params) {
                                var result = "";
                                var nodeName = params.value[2];
                                if (params.value[9]) {
                                    if (params.value[8] > 10) {
                                        var trunText = echarts.format.truncateText(nodeName, 2 * params.value[8], {
                                            fontSize: 14,
                                            fontFamily: "微软雅黑"
                                        }, '.');
                                        if (trunText.indexOf(".") > 0) {
                                            var strindex1 = nodeName.indexOf("患者");
                                            var strindex2 = nodeName.indexOf("管理数");
                                            if (strindex1 > 0) {
                                                result += "{type|" + nodeName.substring(0, strindex1) + "}";
                                            } else {
                                                result += "{type|" + nodeName.substring(0, strindex2) + "}";
                                            }
                                        } else {
                                            result += "{type|" + nodeName + "}";
                                        }
                                        if (params.value[8] > 45) {
                                            result += "\n{num|" + params.value[3] + "}";
                                        }
                                    }
                                } else {
                                    result += "{type|" + params.value[2] + "}";
                                }
                                return result;
                            },
                            rich: {
                                type: {
                                    fontSize: 12,
                                    padding: [5, 0, 5, 0],
                                    color: color
                                },
                                num: {
                                    fontSize: 16,
                                    color: color
                                }
                            }
                        }
                    }
                }
            }
        });

        //echarts 配置
        option = {
            backgroundColor: "transparent",
            title: {
//            text: "2017-10",
                textStyle: {
//                color: "rgba(164, 159, 159, 0.21)",
                    fontSize: 16,
                    fontFamily: "微软雅黑",
                    fontWeight: "normal"
                },
                right: 0,
                bottom: 0
            },
            xAxis: {
                axisLine: {
                    show: false
                },
                axisTick: {
                    show: false
                },
                axisLabel: {
                    show: false
                },
                splitLine: {
                    show: false
                }
            },
            yAxis: {
                axisLine: {
                    show: false
                },
                axisTick: {
                    show: false
                },
                axisLabel: {
                    show: false
                },
                splitLine: {
                    show: false
                }
            },
            tooltip: {
                backgroundColor: "rgba(50,50,50,0.6)",
                formatter: function (params) {
                    var size = ("" + params.value[3]).replace(/\d{1,3}(?=(\d{3})+$)/g, "$&,");
                    var add = ("" + params.value[4]).replace(/\d{1,3}(?=(\d{3})+$)/g, "$&,");
                    var result = "<span>" + params.value[2] + "</span><br>" +
                            "<span style = 'line-height:30px;font-size : 24px;'>" + size + "</span></br>" +
                            "<div>" +
                            "<div style = 'float : left; padding-right:20px; border-right: solid 1px #4c4a4a;'>" +
                            "</div>" +
                            "<div style = 'float : right; margin-left:20px;'>";
                    result += "</div>" +
                            "</div>";
                    return result;
                }
            },
            series: {
                type: "custom",
                renderItem: renderItem,
                data: seriesData
            }
        };
        myChart.setOption(option);
    }

    function initProvince(provinceData) {
        console.log(provinceData);
        //地图
        var myChart = echarts.init(document.getElementById('map'), 'macarons');

        var data = [

            {
                name: '齐齐哈尔'
            }, {
                name: '盐城'
            }, {
                name: '青岛'
            }, {
                name: '金昌'
            }, {
                name: '泉州'
            }, {
                name: '拉萨'
            }, {
                name: '上海浦东'
            }, {
                name: '攀枝花'
            }, {
                name: '威海'
            }, {
                name: '承德'
            }, {
                name: '汕尾'
            }, {
                name: '克拉玛依'
            }, {
                name: '重庆市'
            }

        ];

        var geoCoordMap = {

            '齐齐哈尔': [123.97, 47.33],
            '盐城': [120.13, 33.38],
            '青岛': [120.33, 36.07],
            '金昌': [102.188043, 38.520089],
            '泉州': [118.58, 24.93],
            '拉萨': [91.11, 29.97],
            '上海浦东': [121.48, 31.22],
            '攀枝花': [101.718637, 26.582347],
            '威海': [122.1, 37.5],
            '承德': [117.93, 40.97],
            '汕尾': [115.375279, 22.786211],
            '克拉玛依': [84.77, 45.59],
            '重庆市': [108.384366, 30.439702],

        };


        myChart.setOption({
            series: [{
                type: 'map',
                map: 'china'
            }]
        });


        var convertData = function (data) {
            var res = [];

            for (var i = 0; i < data.length; i++) {
                var geoCoord = geoCoordMap[data[i].name];

                if (geoCoord) {
                    res.push({
                        name: data[i].name,
                        value: geoCoord.concat(data[i].value)
                    });
                }
            }

            return res;
        };

        option = {


            title: {
//            text: '中国大区分布图',
//            subtext: '中国的八大区分布',
                sublink: '#',

                itemGap: 30,

                left: 'center',
                textStyle: {

                    color: '#1a1b4e',

                    fontStyle: 'normal',

                    fontWeight: 'bold',

                    fontSize: 30

                },

                subtextStyle: {


                    color: '#58d9df',

                    fontStyle: 'normal',

                    fontWeight: 'bold',

                    fontSize: 16


                }
            },

            tooltip: {
                trigger: 'item'

            },

            visualMap: {
                min: 0,
                max: 100,
                left: 'left',
                top: 'bottom',
                text: ['高', '低'],
                calculable: true,
                inRange: {
                    color: ['#ffffff', '#E0DAFF', '#ADBFFF', '#9CB4FF', '#6A9DFF', '#3889FF']
                }
            },


            geo: {
                map: 'china',
                zoom: 1.2,
                label: {
                    normal: {

                        show: true,
                        color: '#c1c4c8'
                    },
                    emphasis: {
                        show: false,
                        color: '#292929'
                    }
                },
                roam: true,
                itemStyle: {
                    normal: {
                        areaColor: '#fbfbfb',
                        borderColor: '#b9b4b7'

                    },
                    emphasis: {
                        areaColor: '#1e9fff'
                    }
                }
            },
            series: [{
                name: '供需占比',
                type: 'effectScatter',
                coordinateSystem: 'geo',
                data: convertData(data),
                symbolSize: 10,
                showEffectOn: 'render',
                rippleEffect: {
                    brushType: 'stroke'
                },
                hoverAnimation: true,
                label: {
                    normal: {
                        formatter: '{b}',
                        position: 'right',
                        show: false
                    },
                    emphasis: {
                        show: true
                    }
                },
                itemStyle: {
                    normal: {
                        color: '#c60fff',
                        shadowBlur: 10,
                        shadowColor: '#333'
                    }
                }
            }, {
                type: 'map',
                mapType: 'china',
                geoIndex: 0,
                label: {
                    normal: {
                        show: true
                    },
                    emphasis: {
                        show: true
                    }
                },
                data: provinceData
            }]
        };


        myChart.setOption(option);


        myChart.on('mouseover', function (params) {
            var city = params.name;


            if (city == '广东' || city == '广西' || city == '海南') {

                myChart.dispatchAction({
                    type: 'highlight',
                    name: "广东"
                });
                myChart.dispatchAction({
                    type: 'highlight',
                    name: "广西"
                });
                myChart.dispatchAction({
                    type: 'highlight',
                    name: "海南"
                });

            }

            if (city == '山东' || city == '江苏' || city == '浙江' || city == '安徽' || city == '福建' || city == '上海') {

                myChart.dispatchAction({
                    type: 'highlight',
                    name: "山东"
                });
                myChart.dispatchAction({
                    type: 'highlight',
                    name: "江苏"
                });
                myChart.dispatchAction({
                    type: 'highlight',
                    name: "浙江"
                });
                myChart.dispatchAction({
                    type: 'highlight',
                    name: "安徽"
                });
                myChart.dispatchAction({
                    type: 'highlight',
                    name: "福建"
                });
                myChart.dispatchAction({
                    type: 'highlight',
                    name: "上海"
                });

            }

            if (city == '湖北' || city == '湖南' || city == '河南' || city == '江西') {

                myChart.dispatchAction({
                    type: 'highlight',
                    name: "湖北"
                });
                myChart.dispatchAction({
                    type: 'highlight',
                    name: "湖南"
                });
                myChart.dispatchAction({
                    type: 'highlight',
                    name: "河南"
                });
                myChart.dispatchAction({
                    type: 'highlight',
                    name: "江西"
                });


            }

            if (city == '北京' || city == '天津' || city == '河北' || city == '山西' || city == '内蒙古') {

                myChart.dispatchAction({
                    type: 'highlight',
                    name: "北京"
                });
                myChart.dispatchAction({
                    type: 'highlight',
                    name: "天津"
                });
                myChart.dispatchAction({
                    type: 'highlight',
                    name: "河北"
                });
                myChart.dispatchAction({
                    type: 'highlight',
                    name: "山西"
                });
                myChart.dispatchAction({
                    type: 'highlight',
                    name: "内蒙古"
                });


            }
            if (city == '宁夏' || city == '新疆' || city == '青海' || city == '陕西' || city == '甘肃') {

                myChart.dispatchAction({
                    type: 'highlight',
                    name: "宁夏"
                });
                myChart.dispatchAction({
                    type: 'highlight',
                    name: "新疆"
                });
                myChart.dispatchAction({
                    type: 'highlight',
                    name: "青海"
                });
                myChart.dispatchAction({
                    type: 'highlight',
                    name: "陕西"
                });
                myChart.dispatchAction({
                    type: 'highlight',
                    name: "甘肃"
                });


            }
            if (city == '四川' || city == '云南' || city == '贵州' || city == '西藏' || city == '重庆') {

                myChart.dispatchAction({
                    type: 'highlight',
                    name: "四川"
                });
                myChart.dispatchAction({
                    type: 'highlight',
                    name: "云南"
                });
                myChart.dispatchAction({
                    type: 'highlight',
                    name: "贵州"
                });
                myChart.dispatchAction({
                    type: 'highlight',
                    name: "西藏"
                });
                myChart.dispatchAction({
                    type: 'highlight',
                    name: "重庆"
                });


            }
            if (city == '辽宁' || city == '吉林' || city == '黑龙江') {

                myChart.dispatchAction({
                    type: 'highlight',
                    name: "辽宁"
                });
                myChart.dispatchAction({
                    type: 'highlight',
                    name: "吉林"
                });
                myChart.dispatchAction({
                    type: 'highlight',
                    name: "黑龙江"
                });


            }
            if (city == '台湾' || city == '香港' || city == '澳门') {

                myChart.dispatchAction({
                    type: 'highlight',
                    name: "台湾"
                });
                myChart.dispatchAction({
                    type: 'highlight',
                    name: "香港"
                });
                myChart.dispatchAction({
                    type: 'highlight',
                    name: "澳门"
                });


            }


        });

        myChart.on('mouseout', function (params) {
            var city = params.name;


            if (city == '广东' || city == '广西' || city == '海南') {

                myChart.dispatchAction({
                    type: 'downplay',
                    name: "广东"
                });
                myChart.dispatchAction({
                    type: 'downplay',
                    name: "广西"
                });
                myChart.dispatchAction({
                    type: 'downplay',
                    name: "海南"
                });

            }
            if (city == '山东' || city == '江苏' || city == '浙江' || city == '安徽' || city == '福建' || city == '上海') {

                myChart.dispatchAction({
                    type: 'downplay',
                    name: "山东"
                });
                myChart.dispatchAction({
                    type: 'downplay',
                    name: "江苏"
                });
                myChart.dispatchAction({
                    type: 'downplay',
                    name: "浙江"
                });
                myChart.dispatchAction({
                    type: 'downplay',
                    name: "安徽"
                });
                myChart.dispatchAction({
                    type: 'downplay',
                    name: "福建"
                });
                myChart.dispatchAction({
                    type: 'downplay',
                    name: "上海"
                });

            }
            if (city == '湖北' || city == '湖南' || city == '河南' || city == '江西') {

                myChart.dispatchAction({
                    type: 'downplay',
                    name: "湖北"
                });
                myChart.dispatchAction({
                    type: 'downplay',
                    name: "湖南"
                });
                myChart.dispatchAction({
                    type: 'downplay',
                    name: "河南"
                });
                myChart.dispatchAction({
                    type: 'downplay',
                    name: "江西"
                });

            }
            if (city == '北京' || city == '天津' || city == '河北' || city == '山西' || city == '内蒙古') {

                myChart.dispatchAction({
                    type: 'downplay',
                    name: "北京"
                });
                myChart.dispatchAction({
                    type: 'downplay',
                    name: "天津"
                });
                myChart.dispatchAction({
                    type: 'downplay',
                    name: "河北"
                });
                myChart.dispatchAction({
                    type: 'downplay',
                    name: "山西"
                });
                myChart.dispatchAction({
                    type: 'downplay',
                    name: "内蒙古"
                });

            }
            if (city == '宁夏' || city == '新疆' || city == '青海' || city == '陕西' || city == '甘肃') {

                myChart.dispatchAction({
                    type: 'downplay',
                    name: "宁夏"
                });
                myChart.dispatchAction({
                    type: 'downplay',
                    name: "新疆"
                });
                myChart.dispatchAction({
                    type: 'downplay',
                    name: "青海"
                });
                myChart.dispatchAction({
                    type: 'downplay',
                    name: "陕西"
                });
                myChart.dispatchAction({
                    type: 'downplay',
                    name: "甘肃"
                });

            }
            if (city == '四川' || city == '云南' || city == '贵州' || city == '西藏' || city == '重庆') {

                myChart.dispatchAction({
                    type: 'downplay',
                    name: "四川"
                });
                myChart.dispatchAction({
                    type: 'downplay',
                    name: "云南"
                });
                myChart.dispatchAction({
                    type: 'downplay',
                    name: "贵州"
                });
                myChart.dispatchAction({
                    type: 'downplay',
                    name: "西藏"
                });
                myChart.dispatchAction({
                    type: 'downplay',
                    name: "重庆"
                });

            }
            if (city == '辽宁' || city == '黑龙江' || city == '吉林') {

                myChart.dispatchAction({
                    type: 'downplay',
                    name: "辽宁"
                });
                myChart.dispatchAction({
                    type: 'downplay',
                    name: "黑龙江"
                });
                myChart.dispatchAction({
                    type: 'downplay',
                    name: "吉林"
                });

            }
            if (city == '台湾' || city == '香港' || city == '澳门') {

                myChart.dispatchAction({
                    type: 'downplay',
                    name: "台湾"
                });

                myChart.dispatchAction({
                    type: 'downplay',
                    name: "香港"
                });


                myChart.dispatchAction({
                    type: 'downplay',
                    name: "澳门"
                });

            }

        });
        myChart.setOption(option);
    }
</script>
</html>