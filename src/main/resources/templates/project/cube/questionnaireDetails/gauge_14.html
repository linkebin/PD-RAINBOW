<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <meta charset="UTF-8">
    <title>问卷填写详情</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/Styles/themes/default/style.css" rel="stylesheet" type="text/css" />
    <script src="../../../../static/pack.ajax.js"></script>
</head>
<body class="questionBody">
<div class="questionHeader">
    <div class="eui-row eui-area xymf-width1000">
        <div class="xymfLogo eui-col-md12">
            <img src="../../Styles/images/xymfImages/xymf/logo.png" alt="">
            <span class="payCentre">问卷详情</span>
        </div>
    </div>
</div>

<div class="visitorContent">
    <div class="eui-area xymf-width1000 xymf-marginB60">
        <div class="visitorTitle">
            <span id="questionnaireName"></span>
        </div>
        <div id="divSuccess" class="eui-bg-white eui-padding20 visitor">
            <div class="eui-row eui-font16">
                <div class="eui-col-md5">
                    <p class="eui-marginB10">
                        <span class="eui-color-gray3">客户名称：</span>
                        <span id="visitorName">张三</span>
                    </p>
                    <p class="eui-marginB10">
                        <span class="eui-color-gray3">填写日期：</span>
                        <span id="createTime"></span>
                    </p>
                </div>
                <div class="eui-col-md7">
                   <!-- <p class="eui-marginB10">
                        <span class="eui-color-gray3">结果：</span>
                        <span class="eui-color-blue">轻度焦虑</span>
                    </p>
                    <p class="eui-marginB10">
                        <span class="eui-color-gray3">标准分：</span>
                        <span class="eui-color-blue">55.5</span>
                    </p>-->
                    <p class="eui-marginB10">
                        <span class="eui-color-gray3">总分：</span>
                        <span id="totalScore"></span>
                    </p>
                    <p class="eui-marginB10">
                        <span class="eui-color-gray3">耗时：</span>
                        <span id="timeConsuming"></span>
                    </p>
                </div>
            </div>
            <div class="eui-row dataCharts">
                <div class="eui-col-md6">
                    <div id="main1"  style="width: 100%;height:320px;"></div>
                </div>
                <div class="eui-col-md6">
                    <div id="main2"  style="width: 100%;height:320px;"></div>
                </div>
            </div>
            <div id="dataResult" class="eui-marginTB20">
                <table class="eui-table" e-even e-skin="nob">
                    <colgroup>
                        <col width="60">
                        <col>
                        <col>
                    </colgroup>
                   <tr>
                       <th></th>
                       <th>N</th>
                       <th>学习M±S</th>
                       <th>教师M±S</th>
                       <th>家庭环境M±S</th>
                       <th>父母管教M±S</th>
                       <th>同学朋友M±S</th>
                       <th>社会文化M±S</th>
                       <th>自我身心M±S</th>
                       <th>总均分M±S</th>
                   </tr>
                   <tr>
                       <td>初一</td>
                       <td>336</td>
                       <td>6.13±3.70</td>
                       <td>3.19±4.45</td>
                       <td>1.82±3.02</td>
                       <td>2.39±2.54</td>
                       <td>4.37±4.25</td>
                       <td>2.88±3.12</td>
                       <td>4.00±2.94</td>
                       <td>24.78±19.32</td>
                   </tr>
                    <tr>
                        <td>初二</td>
                        <td>324</td>
                        <td>7.12±3.43</td>
                        <td>6.19±5.12</td>
                        <td>2.67±3.52</td>
                        <td>2.82±2.57</td>
                        <td>5.68±4.66</td>
                        <td>3.58±3.51</td>
                        <td>4.92±3.21</td>
                        <td>32.98±20.51</td>
                    </tr>
                    <tr>
                        <td>初三</td><td>334</td><td>8.46±3.46</td><td>5.97±5.43</td><td>2.86±3.80</td><td>2.99±2.79</td><td>6.21±4.77</td><td>3.63±3.79</td><td>5.83±3.36</td><td>35.96±22.94</td>
                    </tr>
                    <tr>
                        <td>高一</td><td>298</td><td>7.93±3.49</td><td>6.67±6.04</td><td>3.17±4.11</td><td>2.86±2.93</td><td>6.10±4.89</td><td>3.72±3.69</td><td>5.86±3.30</td><td>36.32±22.94</td>
                    </tr>
                    <tr>
                        <td>高二</td><td>303</td><td>7.97±3.52</td><td>6.69±6.44</td><td>2.66±3.31</td><td>2.68±2.55</td><td>5.90±5.20</td><td>3.45±3.09</td><td>5.65±3.04</td><td>35.00±20.79</td>
                    </tr>
                    <tr>
                        <td>高三</td><td>275</td><td>7.63±3.45</td><td>6.73±5.43</td><td>2.97±3.42</td><td>2.55±2.26</td><td>5.77±4.30</td><td>3.25±2.99</td><td>5.53±2.75</td><td>34.42±18.31</td>
                    </tr>
                    <tr>
                        <td>男性</td><td>926</td><td>7.28±3.62</td><td>5.84±5.80</td><td>2.60±3.55</td><td>2.76±2.64</td><td>5.70±4.73</td><td>3.70±3.47</td><td>5.29±3.30</td><td>33.16±21.10</td>
                    </tr>
                    <tr>
                        <td>女性</td><td>944</td><td>7.76±3.54</td><td>5.86±5.51</td><td>2.75±3.58</td><td>2.67±2.61</td><td>5.61±4.72</td><td>3.13±3.30</td><td>5.27±3.07</td><td>33.06±21.10</td>
                    </tr>
                </table>
            </div>
           <form class="eui-paddingT20">
               <input type="hidden" th:value="${questionnaireId}"  id="questionnaireId"/>
               <input type="hidden" th:value="${userId}"  id="userId"/>
               <input type="hidden" th:value="${acquisitionId}"  id="acquisitionId"/>

             <div class="eui-bg-white eui-form" id="divTable">
                 <div class="eui-form-item eui-padding20">
                    <!--<div class="eui-font18">
                        1.你经常头痛吗？
                    </div>
                    <input type="radio" name="sex" value="男" title="男" >
                    <input type="radio" name="sex" value="女" title="女">
                    <input type="radio" name="sex" value="男" title="男" >
                    <input type="radio" name="sex" value="女" title="女">
                    -->
                   </div>
             </div>
           </form>

        </div>
        <!--<div class="eui-textAlignC eui-bg-white eui-padding20" id="submitBnt">
        </div>-->
    </div>
</div>
<div class="xymfFooter">
    <!-- 底部固定区域 -->
    © 2017 广州市易度软件开发有限公司旗下心云魔方品牌
</div>





<!-- 返回顶部按钮 -->
<span class="eui-icon eui-backTop" e-type="top">&#xe604;</span>

<script src="/Scripts/module/eui.js"></script>
<script src="/date2format.js"></script>
<script type="text/javascript" src="/Scripts/jquery-1.9.0.min.js"></script>
<!-- 引入 ECharts 文件 -->
<script src="/Scripts/plugins/echarts/echarts.min.js"></script>
<!-- 引入 macarons 主题 -->
<script src="/Scripts/plugins/echarts/macarons.js"></script>

<script>

eui.use(['form', 'layedit', 'laydate','element'], function(){
    var form = eui.form
    ,layer = eui.layer
    ,layedit = eui.layedit
    ,laydate = eui.laydate
    ,element = eui.element;

    //常规用法
    laydate.render({
        elem: '#test1'
    });

});
// 返回顶部
var winH = $(window).height();

$('.eui-backTop').hide();
$(window).scroll(function(e) {
    var winT = $(window).scrollTop();
    if(winT>winH){
        $('.eui-backTop').fadeIn()
    }else{
        $('.eui-backTop').fadeOut()
    }
});

$('.eui-backTop').click(function(e) {
    $('html,body').animate({scrollTop:0},500)
});

$(function () {
    loadQuestion();

});

//问卷id
var  questionnaireId=$("#questionnaireId").val();
//总分
var totalScore=0;
//因子分
var  factorScore=new Array;
//加载问卷
function  loadQuestion() {
    var  userId=$("#userId").val();
    var  acquisitionId=$("#acquisitionId").val();
  //  var index = layer.load(0, {shade: false}); //0代表加载的风格，支持0-2
    $.post("/cube/questionnaire/question/findQuestionForVisitor"
      ,{"questionnaireId":questionnaireId,"acquisitionId":acquisitionId,"userId":userId}
      ,function (result) {
    //   layer.closeAll();
        console.info(result);
        var context=  getTable(result.data);
        $("#divTable").html(context);
        formRender();
    });
}

//拼接问题
function  getTable(list) {
    if(list.visitorRegister==null){
        $("#visitorName").text(list.activeParticipant.fullName);
    }else{
        $("#visitorName").text(list.visitorRegister.visitorName);
    }
    $("#questionnaireName").text(list.questionnaire.questionnaireName);
    $("#totalScore").text(list.dataAcquisition.totalScore);
    var timeConsuming=list.dataAcquisition.timeConsuming;
    var array=timeConsuming.split(":");
    var  timeStr='';
    for(var i in array){
        if(array[i]=="00" || array[i]==""){
            array[i]="0";
        }
    }
         timeStr+= array[0]+"时";
         timeStr+= array[1]+"分";
         timeStr+= array[2]+"秒";
    $("#timeConsuming").text(timeStr);
    $("#createTime").text(new Date(list.dataAcquisition.createTime).Format("yyyy-MM-dd"));

    var context="";
    var dataResult=list.dataAcquisition.dataResult;
    if(dataResult!=null && dataResult!=""){
        var json=eval("("+dataResult+")");
           totalScore=json.totalScore;
            factorScore.push(json.learningStress);
            factorScore.push(json.teacherStress);
            factorScore.push(json.familyStress);
            factorScore.push(json.parentStress);
            factorScore.push(json.classmateStress);
            factorScore.push(json.societyStress);
            factorScore.push(json.selfStress);
            context+='<div class="eui-font14 eui-form-item eui-lineHeight24 eui-paddingT10">';
            context+="<p>总均分为"+json.totalScoreAverage+"分</p>";

            context+="<p>学习压力因子均分:"+json.learningStress+"分</p>";
            context+="<p>教师压力因子均分:"+json.teacherStress+"分</p>";
            context+="<p>家庭环境压力因子均分:"+json.familyStress+"分</p>";
            context+="<p>父母教养方式压力因子均分:"+json.parentStress+"分</p>";
            context+="<p>同学朋友压力因子均分:"+json.classmateStress+"分</p>";
            context+="<p>社会文化压力因子均分:"+json.societyStress+"分</p>";
            context+="<p>自我身心压力因子均分:"+json.selfStress+"分</p>";
            context+='</div>';

    }

    $("#dataResult").append(context);

    //问题
    var questionList=list.questionList;
    //答案
    var answerList=list.answerList;
    var context="";
    console.info(answerList);
   for(var i in questionList){
    context+='<div questionType="'+questionList[i].questionType+'" radioNmae="answer'+questionList[i].id+'" correctAnswer="'+questionList[i].answer+'" questionId="'+questionList[i].id+'"  class="eui-form-item eui-paddingB10" name="divQuestion">';
    context+='<div class="eui-font14">';
    context+=(parseInt(i)+1)+"."+questionList[i].questionContent;
    context+='</div>';
    var optionAnswer=questionList[i].optionAnswer.split("||");
    var optionScore=questionList[i].optionScore.split("||");
       for( var t in answerList){
           if(answerList[t].questionId==questionList[i].id){
               //截取填写的答案
               var answers= answerList[t].answer.split("||");
               for(var j in optionAnswer){
                   var num=0;
                   for( var a in answers){
                       if(answers[a]==optionAnswer[j] ){
                           context+='  <input type="radio"  optionScore="'+optionScore[j]+'" name="answer'+questionList[i].id+j+'" value="'+optionAnswer[j]+'" title="'+optionAnswer[j]+'" checked >';
                           num++;
                       }
                   }
                   if(num==0){
                       context+='  <input type="radio"  optionScore="'+optionScore[j]+'" name="answer'+questionList[i].id+j+'" value="'+optionAnswer[j]+'" title="'+optionAnswer[j]+'" disabled>';
                   }
               }
           }
       }
       context+=' </div>';
   }
   //初始化图
    initEcharts();
console.info(factorScore);
    return context;
}

function initEcharts() {

    // 基于准备好的dom，初始化echarts实例(风格化图表)
    var myChart1 = echarts.init(document.getElementById('main1'),'macarons');
    // 指定图表的配置项和数据
    var option = {
        title: {
            text: '总分'
        },
        tooltip : {
            formatter: "{a} <br/>{b} : {c}"
        },
        toolbox: {
            feature: {
                restore: {},
                saveAsImage: {}
            }
        },
        series: [
            {
                name: '我的总分',
                type: 'gauge',
                max: 400,
                detail: {formatter:'{value}'},
                data: [{value: totalScore, name: '总分'}]
            }
        ]
    };
    // 使用刚指定的配置项和数据显示图表。
    myChart1.setOption(option);

    // 基于准备好的dom，初始化echarts实例(风格化图表)
    var myChart2 = echarts.init(document.getElementById('main2'),'macarons');
    // 指定图表的配置项和数据
    var option = {
        title: {
            text: '因子分'
        },
        legend: {
            data: ['图一','图二', '张三', '李四']
        },
        radar: [
            {

            },
            {
                indicator: [
                    { text: '学习压力', max: 5 },
                    { text: '教师压力', max: 5 },
                    { text: '家庭环境压力', max: 5 },
                    { text: '父母教养方式压力', max: 5 },
                    { text: '同学朋友压力', max: 5 },
                    { text: '社会文化压力', max: 5 },
                    { text: '自我身心压力', max: 5 },
                ],
                radius: 100
            }
        ],
        series: [
            {
                type: 'radar',
                radarIndex: 1,
                data: [
                    {
                        value: factorScore,
                        label: {
                            normal: {
                                show: true,
                                formatter:function(params) {
                                    return params.value;
                                }
                            }
                        },
                        areaStyle: {
                            normal: {
                                opacity: 0.8,
                                color: new echarts.graphic.RadialGradient(0.5, 0.5, 1, [
                                    {
                                        color: '#B8D3E4',
                                        offset: 0
                                    },
                                    {
                                        color: '#1e9eff',
                                        offset: 1
                                    }
                                ])
                            }
                        }
                    }
                ]
            }
        ]
    }
    // 使用刚指定的配置项和数据显示图表。
    myChart2.setOption(option);

}



//form表单  select,checkbox,radio 动态添加  需要更新
function   formRender() {
    eui.use(['form'], function(){
        var form = eui.form;
        form.render();
    });
}
//打印功能
function questionnairePrint () {
    $("#divTable").hide();
    window.print();
}






</script>

</body>
</html>
