<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>我的订单</title>
    <link rel="stylesheet" href="/Styles/themes/default/style.css">
    <script th:src="@{/Scripts/date2format.js}" charset="utf-8"></script>
    <script src="../../../Scripts/module/eui.js" charset="utf-8"></script>
</head>
<body class="eui-layout-body">
<div class="eui-layout eui-layout-admin xymfHome">
    <div class="eui-header">
        <div class="headerIn">
            <div class="eui-logo"><img src="/Styles/images/xymfImages/xymf/logo.png" alt=""></div>
            <!-- 头部区域（可配合layui已有的水平导航） -->
            <ul class="eui-nav xymfNav">
                <li class="eui-nav-item"><a href="">首页</a></li>
                <li class="eui-nav-item"><a href="">分类</a></li>
                <li class="eui-nav-item">
                    <a href="">精品内容</a>
                    <dl class="eui-nav-child">
                        <dd><a href="">问卷调查表</a></dd>
                        <dd><a href="">心理咨询书</a></dd>
                        <dd><a href="">心理课</a></dd>
                    </dl>
                </li>
                <li class="eui-nav-item"><a href="javascript:;">客户</a></li>
            </ul>
            <ul class="eui-nav personage">
                <li class="eui-nav-item"><a href="">
                    <img src="/Styles/images/xymfImages/xymf/VIP.png" alt="">
                    问卷VIP
                </a></li>
                <li class="eui-nav-item">
                    <a href="javascript:;">
                        <img src="/Styles/images/xymfImages/xymf/SNS.png" alt=""><span
                            class="eui-badge eui-bg-blue">9</span>
                        个人中心
                    </a>
                    <dl class="eui-nav-child">
                        <dd><a href="">基本资料</a></dd>
                        <dd><a href="">安全设置</a></dd>
                    </dl>
                </li>
            </ul>
        </div>
    </div>
    <div class="eui-area">
        <div class="eui-side eui-bg-white">
            <div class="eui-user-top">
                <p class="eui-font18 eui-userName">杨雪</p>
                <p class="eui-font14 eui-userJob">等级：VIP1</p>
                <div class="eui-userImg">
                    <img src="/Styles/images/avatar.jpg" width="60" alt="">
                </div>
            </div>
            <ul class="cymfNav">
                <li class="nav-this">我的订单</li>
                <li>我的问卷</li>
                <li>我的特权</li>
                <li>个人信息</li>
            </ul>

        </div>
        <div class="eui-body">
            <!-- 内容主体区域 -->
            <div class="orderContent">
                <div class="eui-tab eui-tab-brief" e-filter="docDemoTabBrief">
                    <ul class="eui-tab-title">
                        <li class="eui-this">全部订单</li>
                        <li>已支付</li>
                        <li>未支付</li>
                    </ul>
                    <div class="eui-tab-content">
                        <div class="eui-tab-item eui-show">
                            <div class="orderForm">
                                <table class="orderT">
                                    <colgroup>
                                        <col width="350">
                                        <col width="170">
                                        <col width="170">
                                        <col width="150">
                                        <col>
                                    </colgroup>
                                    <tr>
                                        <th>商品名称</th>
                                        <th>订单金额</th>
                                        <th>下单时间</th>
                                        <th>订单状态</th>
                                        <th>操作</th>
                                    </tr>
                                </table>
                                <div class="orderIn">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>
    <div class="eui-footer">
        <!-- 底部固定区域 -->
        © 2017 广州市易度软件开发有限公司旗下心云魔方品牌
    </div>
</div>

<script src="/Scripts/module/eui.js"></script>
<script type="text/javascript" src="/Scripts/jquery-1.9.0.min.js"></script>

<script>
    //表单
    eui.use(['form', 'laydate', 'element'], function () {
        var form = eui.form
                , element = eui.element
                , laydate = eui.laydate;

        // 日期
        laydate.render({
            elem: '#test-n1'
            , position: 'static'
        });

    });
    $(function () {
        doSearch();
    })

    function doSearch(orderState) {
        console.log(orderState);
        $.post("/order/online/list", {orderState: orderState}, function (result) {
            console.log(result);
            if (result.code = 200) {
                var tableHtml = getTable(result.data);
                $(".orderIn").html(tableHtml);
            }
        })
    }
    /**
     * 拼接表格
     * @param orderList
     */
    function getTable(orderList) {
        var tableHtml = "";
        for (var index in orderList) {
            var order = orderList[index];
            var id = "'" + order.id + "'";//订单Id
            var promotionsId = "'" + order.id + "'";//活动id
            tableHtml += ' <p class="orderCode">订单编号：' + order.orderCode + '</p>' +
                    '<table class="eui-table" e-skin="nob">' +
                    ' <tr class="orderInfo">' +
                    '<td>中学生心理健康调查问卷及报告</td>' +
                    '<td>' + order.orderMoney + '元</td>' +
                    '<td>' + new Date(order.createTime).Format("yyyy-MM-dd hh:mm:ss") + '</td>';
            tableHtml += order.orderState == 1 ? '<td>已支付</td>' : '<td>未支付</td>';
            if (order.orderState == 1) {
                tableHtml += '<td class="eui-textAlignC">' +
                        '<span class="eui-btn eui-btn-normal" onclick="cancelOrder(' + id + ',"")">删除订单</span>' +
                        '</td>' +
                        '</tr>' +
                        '</table>';
                continue;
            }
            tableHtml += '<td class="eui-textAlignC">' +
                    '<span class="eui-btn eui-btn-normal" onclick="payment(' + id + ')">付款</span>' +
                    '<br>' +
                    '<div class="eui-color-blue" onclick="cancelOrder(' + id + ')">取消订单</div>' +
                    '</td>' +
                    '</tr>' +
                    '</table>';
        }
        return tableHtml;
    }
    /**
     * 取消订单
     * @param id
     */
    function cancelOrder(id) {
        $.post("/order/online/delete", {id: id}, function (result) {
            console.log(result);
            if (result.code = 200) {
                doSearch();
            }
        })
    }

    /**
     * 付款
     * @param id
     */
    function payment(id) {
        console.log(id);
    }


    /**
     * tab栏点击事件
     */
    $('ul.eui-tab-title').click(function (event) {
        if (event.target.innerHTML == "全部订单") {
            doSearch();
        } else if (event.target.innerHTML == "未支付") {
            doSearch(2);
        } else {
            doSearch(1);
        }
    })
</script>
</body>
</html>
