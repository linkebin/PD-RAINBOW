<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <meta charset="UTF-8">
    <title>问卷填写</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/Styles/themes/default/style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div class="questionHeader">
    <div class="eui-row">
        <h1 class="eui-col-md1 eui-marginL10"><a href="###"><img src="/Styles/images/xymfImages/logo.png" class="eui-marginT10" alt=""></a></h1>
        <p class="eui-col-md2 eui-color-white eui-font20 eui-padding10 eui-display-Ib questionTitle">问卷填写</p>
    </div>
</div>
<div class="visitorContent">
    <div class="eui-area" style="width: 800px">
        <div class="visitorTitle">
            <img src="/Styles/images/xymfImages/cube.png" width="24" alt=""> 问题卡
        </div>
        <div class="eui-bg-white eui-padding20 visitor">
           <form>
               <input type="hidden" th:value="${questionnaireId}"  id="questionnaireId"/>
               <input type="hidden" th:value="${userId}"  id="userId"/>

             <div class="eui-bg-white eui-form visitorContent" id="divTable" >
                 <div class="eui-form-item eui-padding20">
                    <div class="eui-font18">
                        1.你经常头痛吗？
                    </div>
                    <input type="radio" name="sex" value="男" title="男" >
                    <input type="radio" name="sex" value="女" title="女">
                    <input type="radio" name="sex" value="男" title="男" >
                    <input type="radio" name="sex" value="女" title="女">
                </div>

             </div>
           </form>
        </div>
        <div class="eui-textAlignC eui-bg-white eui-padding20" onclick="submitQuestionnaire()">
            <span class="eui-btn eui-btn-normal eui-btn-big"><img src="/Styles/images/xymfImages/submit.png" width="24" alt=""> 提交问卷</span>
        </div>
    </div>
</div>
<div class="xymfFooter">
    <div class="eui-area eui-row">
        <div class="eui-col-md2">
            <dl class="eui-lineHeight24 eui-color-gray3">
                <dt class="eui-darkgreen eui-font16 eui-paddingTB20">关于我们</dt>
                <dd>关于我们</dd>
                <dd>注册协议</dd>
                <dd>保密协议</dd>
                <dd>帮助中心</dd>
            </dl>
        </div>
        <div class="eui-col-md3">
            <dl>
                <dt class="eui-darkgreen eui-font16 eui-paddingTB20">联系我们</dt>
                <dd class="visitorPhone1 eui-marginB20">
                    <p class="eui-darkgreen eui-font16">020-82314165</p>
                    <p class="eui-color-gray3 eui-font12">平台全国服务热线</p>
                </dd>
                <dd class="visitorPhone2">
                    <p class="eui-darkgreen eui-font16">15622183952</p>
                    <p class="eui-color-gray3 eui-font12">24小时移动热线，实时在您的身边</p>
                </dd>
            </dl>
        </div>
        <div class="eui-col-md2 eui-col-md-offset5 eui-textAlignR">
            <dl>
                <dt class="eui-darkgreen eui-font16 eui-padding20">微信公众号</dt>
                <dd><img src="/Styles/images/xymfImages/QRcode.png" alt=""></dd>
            </dl>
        </div>
    </div>
</div>




<!-- 返回顶部按钮 -->
<span class="eui-icon eui-backTop" e-type="top">&#xe604;</span>

<script src="/Scripts/module/eui.js"></script>
<script type="text/javascript" src="/Scripts/jquery-1.9.0.min.js"></script>
<script>
eui.use(['form', 'layedit', 'laydate'], function(){
    var form = eui.form
    ,layer = eui.layer
    ,layedit = eui.layedit
    ,laydate = eui.laydate;

    //常规用法
    laydate.render({
        elem: '#test1'
    });

});
// 返回顶部
var winH = $(window).height();

$('.eui-backTop').hide();
$(window).scroll(function(e) {
    var winT = $(window).scrollTop();
    if(winT>winH){
        $('.eui-backTop').fadeIn()
    }else{
        $('.eui-backTop').fadeOut()
    }
});

$('.eui-backTop').click(function(e) {
    $('html,body').animate({scrollTop:0},500)
});

$(function () {
    loadQuestion();
})

//问卷id
var  questionnaireId=$("#questionnaireId").val();

function  loadQuestion() {
    $.post("/cube/questionnaire/question/findQuestionForQuestionnaire",{"id":questionnaireId},function (result) {
        console.info(result);
        var context=  getTable(result.data);
        $("#divTable").html(context);
        formRender();
    });


}


function  getTable(questionList) {
    var context="";
   for(var i in questionList){
    context+='<div radioNmae="answer'+questionList[i].id+'" correctAnswer="'+questionList[i].answer+'" questionId="'+questionList[i].id+'"  class="eui-form-item eui-padding20" name="divQuestion">';
    context+='<div class="eui-font18">';
    context+=(parseInt(i)+1)+"."+questionList[i].questionContent;
    context+='</div>';
    var optionAnswer=questionList[i].optionAnswer.split("||");
    var optionScore=questionList[i].optionScore.split("||");
    for(var j in optionAnswer){
        context+='  <input type="radio"  optionScore="'+optionScore[j]+'" name="answer'+questionList[i].id+j+'" value="'+optionAnswer[j]+'" title="'+optionAnswer[j]+'" >';
    }
       context+=' </div>';
   }
    return context;
}

/*       var  array=new Array;
 var  obj=new Object();
 //分数
 obj.score="";
 //问题
 obj.questionId="";
 //选择的答案（列子：A:1  B:2  答案： A:1   ）
 obj.answer="";
 array.push(obj);
 var jsonStr= JSON.stringify(array);
 post 请求参数 参数名字  :param    数据: jsonStr
          var jsonStr= JSON.stringify(array);
          post 请求参数 参数名字  :param    数据: jsonStr*/


//判断计算那些问题没有做
  function  flg() {
      var result="";
      var questions=$("[name='divQuestion']");
       for(var i=0;i<questions.length;i++){
           //题目的序号
           var num=parseInt(i)+1;
           //当前第一个对象
           var question=questions.eq(i);
           //获得子的个数
           var size=question.children("input").length;
           //循环当前问题的选项 看有没有被选中
           var state=0;
           for(var j=0;j<size;j++){

               if (question.children("input").eq(j).prop("checked")) {
                   state=1;
               }
           }
           if(state==0){
              //state=0 说明没有做这道题
               result+=num+","
           }

       }
       if(result!=""){
           result+="题没有做，请答完！";
       }
       return result;
  }
  //提交问卷
  function submitQuestionnaire(){
          var state=flg();
          //state=""  则是题目都已经做完
          if(state==""){
           var divQuestions=$("[name='divQuestion']");
              alert(divQuestions.length);
              var  array=new Array;
              for(var i=0;i<divQuestions.length;i++){
                  //获取所有被选中的radio元素
                  var radios=divQuestions.eq(i).children("input:radio:checked");
                  var answer="";
                  var score="";
                  for(var r=0;i<radios.length;r++){
                      answer=answer+"||"+radios.eq(i).val();
                      score=score+"||"+radios.eq(i).attr("optionScore");
                  }
                  answer=answer.substring(2,answer.length);
                  score=score.substring(2,score.length);
                  var  obj=new Object();
                  //分数
                  obj.score=score;
                  //问题
                  obj.questionId=divQuestions.eq(i).attr("questionId");
                  //选择的答案（列子：A:1  B:2  答案： A:1  或者多选  ）
                  obj.answer=answer;
                  //正确答案
                  obj.correctAnswer=divQuestions.eq(i).attr("correctAnswer");
                  array.push(obj);
              }


               var questionnaireId=$("#questionnaireId").val();
               var userId=$("#userId").val();
               console.info("array");
              console.info(array);
              return;
         $.post("/cube/questionnaire/submitQuestionnaire",{"param":JSON.stringify(array),"questionnaireId":questionnaireId,"userId":userId},function (result) {

              });

      }
}

//form表单  select,checkbox,radio 动态添加  需要更新
function   formRender() {
    eui.use(['form'], function(){
        var form = eui.form;
        form.render();
    });
}









</script>

</body>
</html>
