<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>首页</title>
    <link rel="stylesheet" th:href="@{/Styles/themes/default/style.css}" media="all">
    <link rel="stylesheet" th:href="@{/Styles/themes/default/shutter.css}" media="all">
    <style>
     #pages{
        position: absolute;
        left: 10px;
        bottom: 10px;
      }
    .contentForm{
        position: relative;
    }

     div.test
     {
         white-space:nowrap;
         width:80%;
         overflow:hidden;
         cursor: pointer;
     }

    </style>
</head>
<body class="eui-layout-body">
<div class="eui-layout eui-layout-admin xymfHome">
    <div th:replace="project/cube/common/header :: header">Header</div>
    <div class="eui-area">
        <div th:replace="project/cube/common/left :: left">sidebar</div>
        <div class="eui-body">
            <!-- 内容主体区域 -->
            <div class="xymfContent">
                <div class="contentL">
                    <div class="shutter">
                            <div class="shutter-img">
                            </div>
                            <ul class="shutter-btn">
                                <li class="prev"></li>
                                <li class="next"></li>
                            </ul>
                            <div class="shutter-desc">
                    <p>今日活动</p>
                </div>
            </div>
                    <div class="contentForm eui-marginT20">
                        <div class="formTop eui-row">
                            <div class="eui-col-md2 eui-col-md-offset1 eui-font30 eui-color-blue eui-textAlignC">206
                            </div>
                            <div class="eui-col-md1 eui-marginT10">积分</div>
                            <div class="eui-col-md2 eui-font30 eui-color-blue eui-textAlignC">127</div>
                            <div class="eui-col-md1">问卷剩余使用量</div>
                            <div class="eui-col-md2 eui-col-md-offset1"><span
                                    class="eui-btn eui-btn-normal eui-font16 purchase"
                                    onclick="window.location.href='/cube/pay'">购 买</span>
                            </div>
                        </div>
                        <div class="xymfForm">
                            <table class="eui-table eui-form" e-even e-skin="nob">
                                <colgroup>
                                    <col width="60">
                                    <col>
                                    <col>
                                </colgroup>
                                <thead>
                                <tr>
                                    <th><input type="checkbox" e-skin="primary" title=""></th>
                                    <th>名称</th>
                                    <th>客户</th>
                                    <th>时间</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody>
                                <!--<tr>-->
                                <!--<td><input type="checkbox" e-skin="primary" title="" checked=""></td>-->
                                <!--<td>心理测试《认识自己》</td>-->
                                <!--<td>张三</td>-->
                                <!--<td>2016-11-29</td>-->
                                <!--<td><i class="eui-icon">&#xe642;</i> <i class="eui-icon">&#xe640;</i></td>-->
                                <!--</tr>-->
                                <!--<tr>-->
                                <!--<td><input type="checkbox" e-skin="primary" title=""></td>-->
                                <!--<td>心理测试及分析</td>-->
                                <!--<td>李四</td>-->
                                <!--<td>2017-10-22</td>-->
                                <!--<td><i class="eui-icon">&#xe642;</i> <i class="eui-icon">&#xe640;</i></td>-->
                                <!--</tr>-->
                                <!--<tr>-->
                                <!--<td><input type="checkbox" e-skin="primary" title=""></td>-->
                                <!--<td>心理测试小游戏</td>-->
                                <!--<td>王五</td>-->
                                <!--<td>2017-09-10</td>-->
                                <!--<td><i class="eui-icon">&#xe642;</i> <i class="eui-icon">&#xe640;</i></td>-->
                                <!--</tr>-->
                                <!--<tr>-->
                                <!--<td><input type="checkbox" e-skin="primary" title=""></td>-->
                                <!--<td>爱情婚姻观心理测试</td>-->
                                <!--<td>孙剩</td>-->
                                <!--<td>2017-09-10</td>-->
                                <!--<td><i class="eui-icon">&#xe642;</i> <i class="eui-icon">&#xe640;</i></td>-->
                                <!--</tr>-->
                                </tbody>
                            </table>
                        </div>
                        <div id="pages"></div>
                    </div>
                </div>
                <div class="contentR">
                    <div class="eui-inline" id="test-n1"></div>
                    <div class="calendarEvents">
                        <div class="eui-overflowH eui-marginB10">
                            <div id="selectDate" class="eui-float-left">今日</div>
                            <div class="eui-float-right"><i style="cursor: pointer;" onclick="openSchrdule('add','')" class="eui-icon eui-color-gray3">&#xe654;</i></div>
                        </div>
                        <div id="scheduleData">


                        </div>

                    </div>
                </div>
            </div>
        </div>

    </div>
    <div th:replace="project/cube/common/footer :: footer">footer</div>
</div>
</div>

<script th:src="@{/Scripts/module/eui.js}"></script>
<script type="text/javascript" th:src="@{/Scripts/jquery-1.9.0.min.js}"></script>
<script type="text/javascript" th:src="@{/date2format.js}"></script>
<script type="text/javascript" th:src="@{/Scripts/cube/header.js}"></script>
<script type="text/javascript" th:src="@{/Scripts/shutter.js}"></script>
<script type="text/javascript" th:src="@{/Scripts/velocity.js}"></script>
<script>
    $(function () {
        doSearch();
    });
    function openSchrdule(type,id) {
        var index = layer.open({
            title: '预约登记'
            , type: 2
            , area: ['600px', '500px']
            , content: '/web/schedule/visitor/schedule?type='+type+'&id='+id
        });
    }
    $('.activity').click(function () {
        window.location.href = "/cube/activity/ad991a4e-693f-4955-a23a-d8d3d13cebf4";
    });
    function layuiAlertClose(o) {
        layer.closeAll();
        if (o){
            doSearch();
        }
    }
    // 表单
    eui.use(['form', 'layedit', 'laydate', 'laypage', 'layer'], function () {
        var form = eui.form
            , layer = eui.layer
            , layedit = eui.layedit
            , laydate = eui.laydate
            , laypage = eui.laypage;
        $.get("/questionnaire/promotions/list", function (result) {
            console.log(result);
            if (result.message == "SUCCESS") {
                var promotionList = result.data;
                for (var index in promotionList) {
                    var promotion = promotionList[index];
                    if (promotion.imagePath != "") {
                        var imgPath = promotion.imagePath;
                        imgPath = imgPath.substring(imgPath.indexOf("/upload"), imgPath.length);
                        $('.shutter-img').append('<a href="/cube/activity/' + promotion.id + '" data-shutter-title="加量不加价">' +
                            '<img src="/files' + imgPath + '"></a>');
                    }
                }
            }
            form.render();
            $('.shutter').shutter({
                shutterW: 676, // 容器宽度
                shutterH: 128, // 容器高度
                isAutoPlay: true, // 是否自动播放
                playInterval: 3000, // 自动播放时间
                curDisplay: 1, // 当前显示页
                fullPage: false // 是否全屏展示
            });
        })
        form.render();
        //全选
        form.on('checkbox(allChoose)', function (data) {
            var child = $(data.elem).parents('table').find('tbody input[type="checkbox"]');
            child.each(function (index, item) {
                item.checked = data.elem.checked;
            });
            form.render('checkbox');
        });

    });
    //加载数据
    function doSearch() {
        var limits = new Array(5, 10, 15);

        eui.use(['form', 'laypage', 'layer'], function () {
            var form = eui.form
                , laypage = eui.laypage
                , layer = eui.layer,
                $ = eui.jquery;
            //加载层
            var index = layer.load(0, {shade: false}); //0代表加载的风格，支持0-2

            $.ajax({
                url: "/cube/questionnaire//findQuestionnaireUseInfoListByPage",
                data: {
                    page: 1,
                    size: 5
                },
                type: "post",
                success: function (result) {
                    layer.closeAll();
                    // 分页
                    laypage.render({
                        elem: 'pages'
                        ,theme: '#1E9FFF'
                        , count: result.data.total
                        , limit: 5
                        , limits: limits
                        , layout: ['count', 'prev', 'page', 'next', 'limit', 'limits', 'skip']
                        , skip: true
                        , jump: function (obj, first) {
                            if (first) {
                                //第一次，不需要查询数据
                                var questionnaireUseInfoList = result.data.list;

                                //遍历，拼接表格
                                var tableHtml = getTable(questionnaireUseInfoList);
                                $("#questionnaireUseInfo tbody").html(tableHtml);
                                form.render('checkbox');
                            } else {
                                //加载层
                                var index = layer.load(0, {shade: false}); //0代表加载的风格，支持0-2
                                $.ajax({
                                    url: "/cube/questionnaire//findQuestionnaireUseInfoListByPage",
                                    data: {
                                        page: obj.curr,
                                        size: obj.limit
                                    },
                                    type: "post",
                                    success: function (result) {
                                        layer.closeAll();
                                        var questionnaireUseInfoList = result.data.list;
                                        //遍历，拼接表格
                                        var tableHtml = getTable(questionnaireUseInfoList);
                                        $("#questionnaireUseInfo tbody").html(tableHtml);
                                        //重新加载复选框
                                        form.render('checkbox');
                                    }
                                });
                            }
                        }
                    });
                }
            });

        });
    }


    //渲染数据，拼接表格
    function getTable(questionnaireUseInfoList) {
        var tableHtml = '';

        for (var item in questionnaireUseInfoList) {
            var info = questionnaireUseInfoList[item];
            tableHtml += '<tr>' +
                '<td><input name="" e-skin="primary" class="mycheckbox" type="checkbox"><input name="questionnaireSceneId" type="hidden" value="' + info.id + '"></td>' +
                '<td>' + info.questionnaireName + '</td>' +
                '<td>' + info.visitorName + '</td>' +
                '<td>' + new Date(info.createTime).Format('yyyy-MM-dd') + '</td>' +
                '<td>' +
                '<div class="eui-btn-group"> ' +
                '<button class="eui-btn eui-btn-primary eui-btn-mini userEdit" title="编辑用户" onclick="itemclick(' + "'edit','" + info.id + '\')"><i class="eui-icon">&#xe642;</i></button> ' +
                '</div>' +
                '</td>' +
                '</tr>';
        }

        return tableHtml;
    }
</script>
</body>
</html>
