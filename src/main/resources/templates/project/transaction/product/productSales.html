<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>销售分析</title>
    <link rel="stylesheet" href="../../../Styles/themes/default/style.css" media="all">
</head>
<body>
<div class="eui-bg-white eui-row eui-paddingT10">
    <div class="eui-col-md12 eui-paddingR10">
        <div class="eui-row eui-padding10 eui-borderB">
            <div class="eui-col-md12 eui-font18">
                <i class='eui-icon eui-font24'>&#xe62c;</i> 销售情况
            </div>
            <div class="eui-col-md2">
                <a href="#" class="eui-textIn">
                    <p class="eui-textNum">销售总数 <span class="eui-color-blue" id="salesTotal">0</span>个</p>
                </a>
            </div>
            <div class="eui-row eui-padding10 eui-font16">
                <div class="eui-col-md5" style="height: 500px">
                    <div id="ranking" style="width: 100%;height:100%;"></div>
                </div>
                <div class="eui-col-md5" style="height: 500px">
                    <div id="situation" style="width: 100%;height:100%;"></div>
                </div>
            </div>
            <div class="eui-row eui-padding10 eui-font16">
                <div class="eui-col-md5" style="height: 500px">
                    <div id="test" style="width: 100%;height:100%;"></div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="/Scripts/module/eui.js" charset="utf-8"></script>
<script type="text/javascript" src="/Scripts/jquery-1.9.0.min.js"></script>
<script src="/pack.ajax.js" type="text/javascript"></script>
<!-- 引入 ECharts 文件 -->
<script src="/Scripts/plugins/echarts/echarts.min.js"></script>
<!-- 引入 macarons 主题 -->
<script src="/Scripts/plugins/echarts/macarons.js"></script>
<script type="text/javascript">
    var monthDate = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
    var nameData = [];
    var data = [];
    $(function () {
        eui.use(['form', 'layer'], function () {
            var form = eui.form,
                    layer = eui.layer;
            $.get("/product/settings/findTotal", function (result) {
                if (result.code == 200) {
                    var productList = result.data;
                    var salesTotal = 0;
                    for (var i in productList) {
                        var product = productList[i];
                        salesTotal += product.count;
                        nameData.push(product.productName);
                        data.push(product.count);
                        init('ranking', '套餐销售排名', nameData, data);
                        init('test', '套餐销售排名', data, nameData);
                    }
                    $('#salesTotal').html(salesTotal);
                } else {
                    layer.msg(result.message, {
                        icon: 1,
                        time: 1500
                    })
                }
            })

            $.get("/product/settings/findProduct", function (result) {
                if (result.code == 200) {
                    var productList = result.data;
                    for (var i in productList) {
                        var product = productList[i];
                        var paymentTime = new Date(product.paymentTime).getMonth() + 1
                        console.log(paymentTime);
                        if (paymentTime == 1) {
                            monthDate[0]++;
                        } else if (paymentTime == 2) {
                            monthDate[1]++;
                        } else if (paymentTime == 3) {
                            monthDate[2]++;
                        } else if (paymentTime == 4) {
                            monthDate[3]++;
                        } else if (paymentTime == 5) {
                            monthDate[4]++;
                        } else if (paymentTime == 6) {
                            monthDate[5]++;
                        } else if (paymentTime == 7) {
                            monthDate[6]++;
                        } else if (paymentTime == 8) {
                            monthDate[7]++;
                        } else if (paymentTime == 9) {
                            monthDate[8]++;
                        } else if (paymentTime == 10) {
                            monthDate[9]++;
                        } else if (paymentTime == 11) {
                            monthDate[10]++;
                        } else if (paymentTime == 12) {
                            monthDate[11]++;
                        }
                    }
                    console.log(monthDate);
                    initSituation(monthDate);
                } else {
                    layer.msg(result.message, {
                        icon: 1,
                        time: 1500
                    })
                }
            })
        })
    })

    function init(id, text, nameData, data) {
        var myChart = echarts.init(document.getElementById(id), 'macarons');
        option = {
            title: {
                text: text,
                x: 'center'
            },
            color: ['#3398DB'],
            tooltip: {
                trigger: 'axis',
                axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                    type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                }
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            xAxis: [
                {
                    data: nameData,
                    axisTick: {
                        alignWithLabel: true
                    }
                }
            ],
            yAxis: [
                {
                    axisTick: {
                        alignWithLabel: true
                    }
                }
            ],
            series: [
                {
                    name: '销售数量',
                    type: 'bar',
                    barWidth: '40%',
                    data: data
                },

            ],
            label: {
                normal: {
                    show: true,
                    position: 'top',
                    formatter: '{c}'
                }
            },
            itemStyle: {
                normal: {

                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                        offset: 0,
                        color: 'rgba(17, 168,171, 1)'
                    }, {
                        offset: 1,
                        color: 'rgba(17, 168,171, 0.1)'
                    }]),
                    shadowColor: 'rgba(0, 0, 0, 0.1)',
                    shadowBlur: 10
                }
            }
        };
        myChart.setOption(option);
    }

    function initSituation(data) {
        var myChart = echarts.init(document.getElementById('situation'), 'macarons');
        option = {
            title: {
                text: '月增长情况',
                x: 'center'
            },
            tooltip: {
                trigger: 'axis'
            },
            visualMap: {
                show: true,
                min: 0,
                max: 1000,
                left: 'right',
                bottom: '20',
                text: ['高', '低'],
                calculable: false, //手柄
                color: ['red', 'yellow', 'lime', 'cyan'],
            },
            xAxis: {
                type: 'category',
                boundaryGap: false,
                data: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月']
            },
            yAxis: {
                type: 'value'
            },
            series: [{
                name: '数量',
                type: 'line',
                smooth: true,
                data: data
            }]
        };
        myChart.setOption(option);
    }
</script>
</body>
</html>