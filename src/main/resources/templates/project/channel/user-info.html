<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en"  xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <meta charset="UTF-8">
    <title>个人信息</title>
    <link rel="stylesheet" th:href="@{/Styles/themes/mycss/amazeui.cropper.css}">
    <link rel="stylesheet" th:href="@{/Styles/themes/mycss/amazeui.min.css}">
    <link rel="stylesheet" th:href="@{/Styles/themes/mycss/custom_up_img.css}">
    <link rel="stylesheet" th:href="@{/Styles/themes/default/style.css}" media="all">
    <style>
        .defaultDiv{width: 100%; border: 1px solid ghostwhite;}
        .formDiv .eui-form-item label{
            width: 120px;
            padding: 9px 20px;
            text-align: left;
        }
        .subBtn{color: white; background: #3f89ec;}

        input[type="button"],[type="submit"]{
            cursor: pointer;
        }
        input[name='userName'],[name='addr']{
            border: 1px solid #34a8ff;
        }
    </style>
</head>
<body class="eui-layout-body">
<div class="eui-layout eui-layout-admin xymfHome">
    <!--<div th:replace="project/cube/common/header :: header(${7})">Header</div>-->
    <div class="eui-area">
        <!--<div th:replace="project/cube/common/left :: left(${-1})">sidebar</div>-->
        <div style="margin-left: 0px;" class="eui-body">
            <!-- 内容主体区域 -->
            <div class="xymfContent">
                <div class="defaultDiv">
                        <div class="eui-padding15">
                            <h1 class="eui-font16">基本资料</h1>
                        </div>
                    <form style="width: 65%;float: left;" id="userInfoForm" class="eui-padding20" onsubmit="return false;">
                        <div class="formDiv">
                            <input type="hidden" id="id" name="id" th:value="${user.id}">
                            <div class="eui-form-item">
                                <label class="eui-form-label">账号</label>
                                <div class="eui-input-inline">
                                    <input type="text" name="account" th:value="${user.account}" readonly="readonly" class="eui-input eui-width400">
                                </div>
                            </div>

                            <div class="eui-form-item">
                                <label class="eui-form-label">用户名</label>
                                <div class="eui-input-inline eui-width400">
                                    <input readonly="readonly" type="text" name="userName" th:value="${user.userName}"  class="eui-input eui-width400">
                                </div>
                                <div class="eui-form-mid eui-word-aux"><a id="error0" style="color: red;"></a></div>
                            </div>


                            <div class="eui-form-item">
                                <label class="eui-form-label">手机号</label>
                                <div class="eui-input-inline eui-width400">
                                    <input type="text" name="mobile" th:value="${user.mobile}" readonly="readonly"  class="eui-input eui-width400">
                                </div>
                                <!--<div class="eui-form-mid eui-word-aux"><a>更改</a></div>-->
                            </div>

                            <div class="eui-form-item">
                                <label class="eui-form-label">邮箱</label>
                                <div class="eui-input-inline eui-width400">
                                    <input type="text" th:value="${user.email}" name="email" readonly="readonly"  class="eui-input eui-width400">
                                </div>
                                <!--<div class="eui-form-mid eui-word-aux"><a>更改</a></div>-->
                            </div>

                            <div class="eui-form-item">
                                <label class="eui-form-label">推广码</label>
                                <div class="eui-input-inline">
                                    <input th:value="${user.inviterCode}" type="text" name="inviterCode" readonly="readonly"  class="eui-input eui-width400">
                                </div>
                                <div class="eui-form-mid eui-word-aux"></div>
                            </div>
                            <div class="eui-form-item">
                                <label class="eui-form-label"></label>
                                <i class="eui-font12 eui-color-blue">提示: 邀请好友注册时。可将该推广码作为邀请码填充。作为您获得奖励的凭证</i>
                            </div>


                            <div class="eui-form-item">
                                <label class="eui-form-label">详细地址</label>
                                <div class="eui-input-inline">
                                    <!--user.province+user.city+user.district+-->
                                    <input readonly="readonly" th:value="${user.province+user.city+user.district+user.addr}" type="text" name="addr"   class="eui-input eui-width400">
                                </div>
                                <div class="eui-form-mid eui-word-aux"></div>
                            </div>

                            <div class="eui-form-item">
                                <label class="eui-form-label"></label>
                                <div class="eui-input-inline">
                                    <a id="errcode0"></a>
                                </div>

                            </div>
                        </div>
                    </form>

                    <div style="width: 33%;float: right;" class="eui-paddingT20">
                        <p class="eui-marginB10">
                            <!--<button type="button" class="eui-btn eui-btn-small eui-btn-normal" id="upFiles"><i class="eui-icon">&#xe67c;</i>上传图片-->
                        </button>
                        </p>
                    </div>

                    <div style="width: 33%;float: right;" class="eui-marginT10">
                        <div style="width: 100px; height: 100px; float: left;">
                            <img id="headImg" th:src="${'/files'+user.headImg+'?t='+'javascript:Math.random()'}" width="90" height="90">
                        </div>
                    </div>


                    <div style="width: 33%;float: right;" class="eui-paddingT20">
                        <p class="eui-marginB10">
                            <!--<button type="button" class="eui-btn eui-btn-small eui-btn-normal" id="upCertification"><i class="eui-icon">&#xe67c;</i>资质认证上传-->
                            <!--</button>-->
                        </p>
                    </div>

                    <div style="width: 33%;float: right;" class="eui-marginT10">
                        <div style="width: 100px; height: 100px; float: left;">
                            <img id="certificationImg" th:src="${'/files'+user.certification+'?t='+'javascript:Math.random()'}" width="90" height="90">
                        </div>
                    </div>

                </div>
            </div>




        </div>
    </div>
    <div th:replace="project/cube/common/footer :: footer">footer</div>

</div>
<script type="text/javascript" src="/Scripts/jquery-1.9.0.min.js"></script>
<script src="/Scripts/module/eui.js" charset="utf-8"></script>
<script src="/Scripts/main.js" charset="utf-8"></script>



<script src="/Scripts/libs/ligerUI/js/ligerui.all.js" type="text/javascript"></script>
<script src="/pack.ajax.js" type="text/javascript"></script>
<script src="/Scripts/date2format.js" type="text/javascript"></script>
<script src="/Scripts/plugins/jquery.validate.js"></script>
<script src="/Scripts/plugins/amazeui.min.js"></script>
<script src="/Scripts/plugins/cropper.min.js"></script>
<script src="/Scripts/plugins/custom_up_img.js"></script>
<script type="text/javascript" th:src="@{/Scripts/cube/header.js}"></script>
<script src="/Scripts/plugins/distpicker.data.js"></script>
<script src="/Scripts/plugins/distpicker.js"></script>
<script th:inline="javascript">
    /*<![CDATA[*/
    var updateObj  =[[${session.userSession}]];
    /*]]>*/

    eui.use('upload', function(){
        var $ = eui.jquery
            ,upload = eui.upload;


        var uploadInst = upload.render({
            elem: '#upCertification'
            ,url: '/upload/uploadCertification'
            ,before: function(obj){
                //预读本地文件示例，不支持ie8
                obj.preview(function(index, file, result){
                    $('#certificationImg').attr('src', result); //图片链接（base64）
                });
            }
            ,done: function(res){
                //如果上传失败
                if(res.code > 0){
                    return layer.msg('上传失败');
                }
                //上传成功
                layer.msg('上传成功');
                $('#userCertification').text('(已上传资质证明的材料，审核中)');
            }
            ,error: function(){
                //演示失败状态，并实现重传
                layer.msg('上传出错');

            }
        });

    });

    $.post("/upload/findCertification", {}, function (result) {
        if (result.code == 200) {
            if (result.data.certification != null && result.data.certificationStatus == 0 && result.data.certification != ''){
                $('#userCertification').text('(已上传资质证明的材料，审核中)');
                layer.closeAll();
            }else if (result.data.certificationStatus == 1){
                $('#userCertification').text('(已通过审核)');
                layer.closeAll();
            }

        } else {

        }
    });


</script>

<script>

    //监听工具条
    table.on('tool(idTest)', function(obj){
        var data = obj.data; //获得当前行数据
        var layEvent = obj.event; //获得 lay-event 对应的值
        var tr = obj.tr; //获得当前行 tr 的DOM对象
        if(layEvent === 'del'){ //删除
            deleteUser(data.ID_)
        } else if(layEvent === 'edit'){ //编辑
            updateAccount(data.ID_);
        }
    });
    // 表单
    eui.use(['form', 'layedit', 'laydate', 'laypage', 'layer'], function () {
        var form = eui.form
            , layer = eui.layer
            , layedit = eui.layedit
            , laydate = eui.laydate
            , laypage = eui.laypage;

        $('#province').val(updateObj .province);
        $('#province').trigger("change");

        $('#city').val(updateObj .city);
        $('#city').trigger("change");

        $('#district').val(updateObj .district);
        $('#district').trigger("change");
    });

    $(function () {
        $("#userInfoForm").validate({
            submitHandler: function() {
                $("#error0").html('');
                if ($("#userInfoForm input[name='userName']").val()!=''){
                    var obj = $("#userInfoForm").serializeObject();
                    $.post('/user/userUpdate',{json:JSON.stringify(obj)},function (result) {
                        if (result.code ==200){
                            $("#userName").html(obj.userName)
                        }
                        layer.msg(result.message);
                    });
                }else {
                    layer.msg('用户名不能为空')
                }

            }
        });
    });
</script>
</body>
</html>